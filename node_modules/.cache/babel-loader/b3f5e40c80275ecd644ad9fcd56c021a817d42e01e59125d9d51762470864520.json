{"ast":null,"code":"var _InvoiceService;\nimport jsPDF from 'jspdf';\nimport html2canvas from 'html2canvas';\nimport emailjs from '@emailjs/browser';\nexport class InvoiceService {\n  static getInstance() {\n    if (!InvoiceService.instance) {\n      InvoiceService.instance = new InvoiceService();\n    }\n    return InvoiceService.instance;\n  }\n  getTexts(language) {\n    return {\n      ar: {\n        title: 'فكهاني الكويت',\n        subtitle: 'فاتورة شراء',\n        invoice: 'فاتورة رقم',\n        date: 'التاريخ',\n        customer: 'بيانات العميل',\n        name: 'الاسم',\n        phone: 'الهاتف',\n        address: 'العنوان',\n        area: 'المحافظة',\n        items: 'المنتجات',\n        product: 'المنتج',\n        quantity: 'الكمية',\n        price: 'السعر',\n        total: 'المجموع',\n        subtotal: 'المجموع الفرعي',\n        delivery: 'التوصيل',\n        finalTotal: 'المجموع النهائي',\n        paymentMethod: 'طريقة الدفع',\n        cash: 'دفع نقدي',\n        link: 'دفع إلكتروني',\n        currency: 'د.ك',\n        thankYou: 'شكراً لاختياركم فكهاني الكويت',\n        contact: 'للاستفسار: واتساب 99999999'\n      },\n      en: {\n        title: 'Fakahani Kuwait',\n        subtitle: 'Purchase Invoice',\n        invoice: 'Invoice No.',\n        date: 'Date',\n        customer: 'Customer Information',\n        name: 'Name',\n        phone: 'Phone',\n        address: 'Address',\n        area: 'Area',\n        items: 'Items',\n        product: 'Product',\n        quantity: 'Quantity',\n        price: 'Price',\n        total: 'Total',\n        subtotal: 'Subtotal',\n        delivery: 'Delivery',\n        finalTotal: 'Final Total',\n        paymentMethod: 'Payment Method',\n        cash: 'Cash Payment',\n        link: 'Electronic Payment',\n        currency: 'KWD',\n        thankYou: 'Thank you for choosing Fakahani Kuwait',\n        contact: 'For inquiries: WhatsApp 99999999'\n      }\n    };\n  }\n\n  // Helper method to calculate subtotal from items\n  calculateSubtotal(items) {\n    return items.reduce((sum, item) => sum + item.selectedUnit.price * item.quantity, 0);\n  }\n\n  // Helper method to validate invoice calculations\n  validateInvoiceData(invoiceData) {\n    const calculatedSubtotal = this.calculateSubtotal(invoiceData.items);\n    const calculatedTotal = calculatedSubtotal + invoiceData.deliveryPrice;\n    return {\n      ...invoiceData,\n      subtotal: calculatedSubtotal,\n      total: calculatedTotal\n    };\n  }\n  createInvoiceHTML(invoiceData) {\n    const texts = this.getTexts(invoiceData.language)[invoiceData.language];\n    const isRTL = invoiceData.language === 'ar';\n    return `\n      <div style=\"\n        width: 800px;\n        font-family: 'Cairo', 'Arial', sans-serif;\n        direction: ${isRTL ? 'rtl' : 'ltr'};\n        background: white;\n        padding: 40px;\n        color: #333;\n      \">\n        <!-- Header -->\n        <div style=\"\n          background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);\n          color: white;\n          padding: 30px;\n          border-radius: 15px;\n          margin-bottom: 30px;\n          text-align: ${isRTL ? 'right' : 'left'};\n        \">\n          <h1 style=\"margin: 0; font-size: 28px; font-weight: bold;\">${texts.title}</h1>\n          <h2 style=\"margin: 5px 0 0 0; font-size: 16px; opacity: 0.9;\">${texts.subtitle}</h2>\n        </div>\n\n        <!-- Invoice Info -->\n        <div style=\"\n          display: flex;\n          justify-content: space-between;\n          margin-bottom: 30px;\n          padding: 20px;\n          background: #f8fafc;\n          border-radius: 10px;\n        \">\n          <div>\n            <p style=\"margin: 0 0 5px 0; font-weight: bold;\">${texts.invoice}: ${invoiceData.orderNumber}</p>\n            <p style=\"margin: 0; color: #666;\">${texts.date}: ${invoiceData.date}</p>\n          </div>\n        </div>\n\n        <!-- Customer Info -->\n        <div style=\"\n          margin-bottom: 30px;\n          padding: 20px;\n          background: #f8fafc;\n          border-radius: 10px;\n        \">\n          <h3 style=\"margin: 0 0 15px 0; color: #1f2937; font-weight: bold;\">${texts.customer}</h3>\n          <div style=\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;\">\n            <p style=\"margin: 0;\"><strong>${texts.name}:</strong> ${invoiceData.customerInfo.name}</p>\n            <p style=\"margin: 0;\"><strong>${texts.phone}:</strong> ${invoiceData.customerInfo.phone}</p>\n            <p style=\"margin: 0;\"><strong>${texts.address}:</strong> ${invoiceData.customerInfo.address}</p>\n            <p style=\"margin: 0;\"><strong>${texts.area}:</strong> ${invoiceData.customerInfo.area}</p>\n          </div>\n        </div>\n\n        <!-- Items Table -->\n        <div style=\"margin-bottom: 30px;\">\n          <h3 style=\"margin: 0 0 15px 0; color: #1f2937; font-weight: bold;\">${texts.items}</h3>\n          <table style=\"\n            width: 100%;\n            border-collapse: collapse;\n            background: white;\n            border-radius: 10px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          \">\n            <thead>\n              <tr style=\"background: #f3f4f6;\">\n                <th style=\"padding: 15px; text-align: ${isRTL ? 'right' : 'left'}; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.product}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.quantity}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.price}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.total}</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${invoiceData.items.map(item => {\n      const itemTotal = item.selectedUnit.price * item.quantity;\n      const productName = isRTL ? item.product.name.ar || item.product.name.en : item.product.name.en;\n      const unitText = isRTL ? item.selectedUnit.unit.ar : item.selectedUnit.unit.en;\n      return `\n                  <tr>\n                    <td style=\"padding: 12px; border-bottom: 1px solid #f3f4f6;\">${productName}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6;\">${item.quantity} ${unitText}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6;\">${item.selectedUnit.price.toFixed(3)}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6; font-weight: bold; color: #22c55e;\">${itemTotal.toFixed(3)}</td>\n                  </tr>\n                `;\n    }).join('')}\n            </tbody>\n          </table>\n        </div>\n\n        <!-- Totals -->\n        <div style=\"\n          background: #f8fafc;\n          padding: 20px;\n          border-radius: 10px;\n          margin-bottom: 30px;\n        \">\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n            <span>${texts.subtotal}:</span>\n            <span style=\"font-weight: bold;\">${invoiceData.subtotal.toFixed(3)} ${texts.currency}</span>\n          </div>\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n            <span>${texts.delivery}:</span>\n            <span style=\"font-weight: bold;\">${invoiceData.deliveryPrice.toFixed(3)} ${texts.currency}</span>\n          </div>\n          <div style=\"\n            display: flex;\n            justify-content: space-between;\n            padding-top: 10px;\n            border-top: 2px solid #22c55e;\n            font-size: 18px;\n            font-weight: bold;\n            color: #22c55e;\n          \">\n            <span>${texts.finalTotal}:</span>\n            <span>${invoiceData.total.toFixed(3)} ${texts.currency}</span>\n          </div>\n        </div>\n\n        <!-- Payment Method -->\n        <div style=\"\n          background: #f8fafc;\n          padding: 15px;\n          border-radius: 10px;\n          margin-bottom: 30px;\n        \">\n          <p style=\"margin: 0; font-weight: bold;\">\n            ${texts.paymentMethod}: ${invoiceData.paymentMethod === 'cash' ? texts.cash : texts.link}\n          </p>\n        </div>\n\n        <!-- Footer -->\n        <div style=\"\n          text-align: center;\n          padding: 20px;\n          background: #22c55e;\n          color: white;\n          border-radius: 10px;\n        \">\n          <p style=\"margin: 0 0 10px 0; font-size: 16px; font-weight: bold;\">${texts.thankYou}</p>\n          <p style=\"margin: 0; font-size: 14px; opacity: 0.9;\">${texts.contact}</p>\n        </div>\n      </div>\n    `;\n  }\n  async generatePDF(invoiceData) {\n    // Validate and correct calculations\n    const validatedData = this.validateInvoiceData(invoiceData);\n    const htmlContent = this.createInvoiceHTML(validatedData);\n\n    // Create a temporary container\n    const container = document.createElement('div');\n    container.innerHTML = htmlContent;\n    container.style.position = 'absolute';\n    container.style.left = '-9999px';\n    container.style.top = '-9999px';\n\n    // Add to body temporarily\n    document.body.appendChild(container);\n    try {\n      // Generate canvas from HTML\n      const canvas = await html2canvas(container.firstElementChild, {\n        scale: 2,\n        useCORS: true,\n        allowTaint: true,\n        backgroundColor: '#ffffff',\n        width: 800,\n        height: 1200\n      });\n\n      // Create PDF\n      const pdf = new jsPDF({\n        orientation: 'portrait',\n        unit: 'mm',\n        format: 'a4'\n      });\n      const imgData = canvas.toDataURL('image/png');\n      const imgWidth = 210;\n      const pageHeight = 295;\n      const imgHeight = canvas.height * imgWidth / canvas.width;\n      let heightLeft = imgHeight;\n      let position = 0;\n      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n      heightLeft -= pageHeight;\n      while (heightLeft >= 0) {\n        position = heightLeft - imgHeight;\n        pdf.addPage();\n        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n        heightLeft -= pageHeight;\n      }\n      return pdf.output('blob');\n    } finally {\n      // Clean up\n      document.body.removeChild(container);\n    }\n  }\n  async downloadInvoice(invoiceData) {\n    try {\n      // Validate calculations before generating PDF\n      const validatedData = this.validateInvoiceData(invoiceData);\n      const pdfBlob = await this.generatePDF(validatedData);\n      const url = URL.createObjectURL(pdfBlob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `invoice-${invoiceData.orderNumber}.pdf`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n    } catch (error) {\n      console.error('Error downloading invoice:', error);\n      throw error;\n    }\n  }\n  async sendInvoiceEmail(invoiceData, customerEmail) {\n    try {\n      // Validate calculations before generating PDF\n      const validatedData = this.validateInvoiceData(invoiceData);\n      const pdfBlob = await this.generatePDF(validatedData);\n      const base64PDF = await this.blobToBase64(pdfBlob);\n      const templateParams = {\n        to_email: customerEmail,\n        customer_name: invoiceData.customerInfo.name,\n        order_number: invoiceData.orderNumber,\n        total_amount: invoiceData.total.toFixed(3),\n        attachment: base64PDF\n      };\n      await emailjs.send('your_service_id', 'your_template_id', templateParams, 'your_public_key');\n    } catch (error) {\n      console.error('Error sending invoice email:', error);\n      throw error;\n    }\n  }\n  blobToBase64(blob) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => {\n        const base64 = reader.result.split(',')[1];\n        resolve(base64);\n      };\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    });\n  }\n}\n_InvoiceService = InvoiceService;\nInvoiceService.instance = void 0;\nexport default InvoiceService;","map":{"version":3,"names":["jsPDF","html2canvas","emailjs","InvoiceService","getInstance","instance","getTexts","language","ar","title","subtitle","invoice","date","customer","name","phone","address","area","items","product","quantity","price","total","subtotal","delivery","finalTotal","paymentMethod","cash","link","currency","thankYou","contact","en","calculateSubtotal","reduce","sum","item","selectedUnit","validateInvoiceData","invoiceData","calculatedSubtotal","calculatedTotal","deliveryPrice","createInvoiceHTML","texts","isRTL","orderNumber","customerInfo","map","itemTotal","productName","unitText","unit","toFixed","join","generatePDF","validatedData","htmlContent","container","document","createElement","innerHTML","style","position","left","top","body","appendChild","canvas","firstElementChild","scale","useCORS","allowTaint","backgroundColor","width","height","pdf","orientation","format","imgData","toDataURL","imgWidth","pageHeight","imgHeight","heightLeft","addImage","addPage","output","removeChild","downloadInvoice","pdfBlob","url","URL","createObjectURL","href","download","click","revokeObjectURL","error","console","sendInvoiceEmail","customerEmail","base64PDF","blobToBase64","templateParams","to_email","customer_name","order_number","total_amount","attachment","send","blob","Promise","resolve","reject","reader","FileReader","onload","base64","result","split","onerror","readAsDataURL","_InvoiceService"],"sources":["/Users/mac/Documents/GitHub/fruits/src/services/InvoiceService.ts"],"sourcesContent":["import jsPDF from 'jspdf';\nimport html2canvas from 'html2canvas';\nimport { CartItem, Language } from '../types';\nimport emailjs from '@emailjs/browser';\n\nexport interface InvoiceData {\n  orderNumber: string;\n  date: string;\n  customerInfo: {\n    name: string;\n    phone: string;\n    address: string;\n    area: string;\n    notes?: string;\n  };\n  items: CartItem[];\n  subtotal: number;\n  deliveryPrice: number;\n  total: number;\n  paymentMethod: 'link' | 'cash';\n  language: Language;\n}\n\nexport class InvoiceService {\n  private static instance: InvoiceService;\n\n  public static getInstance(): InvoiceService {\n    if (!InvoiceService.instance) {\n      InvoiceService.instance = new InvoiceService();\n    }\n    return InvoiceService.instance;\n  }\n\n  private getTexts(language: Language) {\n    return {\n      ar: {\n        title: 'فكهاني الكويت',\n        subtitle: 'فاتورة شراء',\n        invoice: 'فاتورة رقم',\n        date: 'التاريخ',\n        customer: 'بيانات العميل',\n        name: 'الاسم',\n        phone: 'الهاتف',\n        address: 'العنوان',\n        area: 'المحافظة',\n        items: 'المنتجات',\n        product: 'المنتج',\n        quantity: 'الكمية',\n        price: 'السعر',\n        total: 'المجموع',\n        subtotal: 'المجموع الفرعي',\n        delivery: 'التوصيل',\n        finalTotal: 'المجموع النهائي',\n        paymentMethod: 'طريقة الدفع',\n        cash: 'دفع نقدي',\n        link: 'دفع إلكتروني',\n        currency: 'د.ك',\n        thankYou: 'شكراً لاختياركم فكهاني الكويت',\n        contact: 'للاستفسار: واتساب 99999999'\n      },\n      en: {\n        title: 'Fakahani Kuwait',\n        subtitle: 'Purchase Invoice',\n        invoice: 'Invoice No.',\n        date: 'Date',\n        customer: 'Customer Information',\n        name: 'Name',\n        phone: 'Phone',\n        address: 'Address',\n        area: 'Area',\n        items: 'Items',\n        product: 'Product',\n        quantity: 'Quantity',\n        price: 'Price',\n        total: 'Total',\n        subtotal: 'Subtotal',\n        delivery: 'Delivery',\n        finalTotal: 'Final Total',\n        paymentMethod: 'Payment Method',\n        cash: 'Cash Payment',\n        link: 'Electronic Payment',\n        currency: 'KWD',\n        thankYou: 'Thank you for choosing Fakahani Kuwait',\n        contact: 'For inquiries: WhatsApp 99999999'\n      }\n    };\n  }\n\n  // Helper method to calculate subtotal from items\n  private calculateSubtotal(items: CartItem[]): number {\n    return items.reduce((sum, item) => sum + (item.selectedUnit.price * item.quantity), 0);\n  }\n\n  // Helper method to validate invoice calculations\n  private validateInvoiceData(invoiceData: InvoiceData): InvoiceData {\n    const calculatedSubtotal = this.calculateSubtotal(invoiceData.items);\n    const calculatedTotal = calculatedSubtotal + invoiceData.deliveryPrice;\n    \n    return {\n      ...invoiceData,\n      subtotal: calculatedSubtotal,\n      total: calculatedTotal\n    };\n  }\n\n  private createInvoiceHTML(invoiceData: InvoiceData): string {\n    const texts = this.getTexts(invoiceData.language)[invoiceData.language];\n    const isRTL = invoiceData.language === 'ar';\n    \n    return `\n      <div style=\"\n        width: 800px;\n        font-family: 'Cairo', 'Arial', sans-serif;\n        direction: ${isRTL ? 'rtl' : 'ltr'};\n        background: white;\n        padding: 40px;\n        color: #333;\n      \">\n        <!-- Header -->\n        <div style=\"\n          background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);\n          color: white;\n          padding: 30px;\n          border-radius: 15px;\n          margin-bottom: 30px;\n          text-align: ${isRTL ? 'right' : 'left'};\n        \">\n          <h1 style=\"margin: 0; font-size: 28px; font-weight: bold;\">${texts.title}</h1>\n          <h2 style=\"margin: 5px 0 0 0; font-size: 16px; opacity: 0.9;\">${texts.subtitle}</h2>\n        </div>\n\n        <!-- Invoice Info -->\n        <div style=\"\n          display: flex;\n          justify-content: space-between;\n          margin-bottom: 30px;\n          padding: 20px;\n          background: #f8fafc;\n          border-radius: 10px;\n        \">\n          <div>\n            <p style=\"margin: 0 0 5px 0; font-weight: bold;\">${texts.invoice}: ${invoiceData.orderNumber}</p>\n            <p style=\"margin: 0; color: #666;\">${texts.date}: ${invoiceData.date}</p>\n          </div>\n        </div>\n\n        <!-- Customer Info -->\n        <div style=\"\n          margin-bottom: 30px;\n          padding: 20px;\n          background: #f8fafc;\n          border-radius: 10px;\n        \">\n          <h3 style=\"margin: 0 0 15px 0; color: #1f2937; font-weight: bold;\">${texts.customer}</h3>\n          <div style=\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;\">\n            <p style=\"margin: 0;\"><strong>${texts.name}:</strong> ${invoiceData.customerInfo.name}</p>\n            <p style=\"margin: 0;\"><strong>${texts.phone}:</strong> ${invoiceData.customerInfo.phone}</p>\n            <p style=\"margin: 0;\"><strong>${texts.address}:</strong> ${invoiceData.customerInfo.address}</p>\n            <p style=\"margin: 0;\"><strong>${texts.area}:</strong> ${invoiceData.customerInfo.area}</p>\n          </div>\n        </div>\n\n        <!-- Items Table -->\n        <div style=\"margin-bottom: 30px;\">\n          <h3 style=\"margin: 0 0 15px 0; color: #1f2937; font-weight: bold;\">${texts.items}</h3>\n          <table style=\"\n            width: 100%;\n            border-collapse: collapse;\n            background: white;\n            border-radius: 10px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          \">\n            <thead>\n              <tr style=\"background: #f3f4f6;\">\n                <th style=\"padding: 15px; text-align: ${isRTL ? 'right' : 'left'}; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.product}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.quantity}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.price}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.total}</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${invoiceData.items.map(item => {\n                const itemTotal = item.selectedUnit.price * item.quantity;\n                const productName = isRTL ? (item.product.name.ar || item.product.name.en) : item.product.name.en;\n                const unitText = isRTL ? item.selectedUnit.unit.ar : item.selectedUnit.unit.en;\n                return `\n                  <tr>\n                    <td style=\"padding: 12px; border-bottom: 1px solid #f3f4f6;\">${productName}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6;\">${item.quantity} ${unitText}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6;\">${item.selectedUnit.price.toFixed(3)}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6; font-weight: bold; color: #22c55e;\">${itemTotal.toFixed(3)}</td>\n                  </tr>\n                `;\n              }).join('')}\n            </tbody>\n          </table>\n        </div>\n\n        <!-- Totals -->\n        <div style=\"\n          background: #f8fafc;\n          padding: 20px;\n          border-radius: 10px;\n          margin-bottom: 30px;\n        \">\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n            <span>${texts.subtotal}:</span>\n            <span style=\"font-weight: bold;\">${invoiceData.subtotal.toFixed(3)} ${texts.currency}</span>\n          </div>\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n            <span>${texts.delivery}:</span>\n            <span style=\"font-weight: bold;\">${invoiceData.deliveryPrice.toFixed(3)} ${texts.currency}</span>\n          </div>\n          <div style=\"\n            display: flex;\n            justify-content: space-between;\n            padding-top: 10px;\n            border-top: 2px solid #22c55e;\n            font-size: 18px;\n            font-weight: bold;\n            color: #22c55e;\n          \">\n            <span>${texts.finalTotal}:</span>\n            <span>${invoiceData.total.toFixed(3)} ${texts.currency}</span>\n          </div>\n        </div>\n\n        <!-- Payment Method -->\n        <div style=\"\n          background: #f8fafc;\n          padding: 15px;\n          border-radius: 10px;\n          margin-bottom: 30px;\n        \">\n          <p style=\"margin: 0; font-weight: bold;\">\n            ${texts.paymentMethod}: ${invoiceData.paymentMethod === 'cash' ? texts.cash : texts.link}\n          </p>\n        </div>\n\n        <!-- Footer -->\n        <div style=\"\n          text-align: center;\n          padding: 20px;\n          background: #22c55e;\n          color: white;\n          border-radius: 10px;\n        \">\n          <p style=\"margin: 0 0 10px 0; font-size: 16px; font-weight: bold;\">${texts.thankYou}</p>\n          <p style=\"margin: 0; font-size: 14px; opacity: 0.9;\">${texts.contact}</p>\n        </div>\n      </div>\n    `;\n  }\n\n  public async generatePDF(invoiceData: InvoiceData): Promise<Blob> {\n    // Validate and correct calculations\n    const validatedData = this.validateInvoiceData(invoiceData);\n    const htmlContent = this.createInvoiceHTML(validatedData);\n    \n    // Create a temporary container\n    const container = document.createElement('div');\n    container.innerHTML = htmlContent;\n    container.style.position = 'absolute';\n    container.style.left = '-9999px';\n    container.style.top = '-9999px';\n    \n    // Add to body temporarily\n    document.body.appendChild(container);\n    \n    try {\n      // Generate canvas from HTML\n      const canvas = await html2canvas(container.firstElementChild as HTMLElement, {\n        scale: 2,\n        useCORS: true,\n        allowTaint: true,\n        backgroundColor: '#ffffff',\n        width: 800,\n        height: 1200\n      });\n      \n      // Create PDF\n      const pdf = new jsPDF({\n        orientation: 'portrait',\n        unit: 'mm',\n        format: 'a4'\n      });\n      \n      const imgData = canvas.toDataURL('image/png');\n      const imgWidth = 210;\n      const pageHeight = 295;\n      const imgHeight = (canvas.height * imgWidth) / canvas.width;\n      let heightLeft = imgHeight;\n      \n      let position = 0;\n      \n      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n      heightLeft -= pageHeight;\n      \n      while (heightLeft >= 0) {\n        position = heightLeft - imgHeight;\n        pdf.addPage();\n        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n        heightLeft -= pageHeight;\n      }\n      \n      return pdf.output('blob');\n    } finally {\n      // Clean up\n      document.body.removeChild(container);\n    }\n  }\n\n  public async downloadInvoice(invoiceData: InvoiceData): Promise<void> {\n    try {\n      // Validate calculations before generating PDF\n      const validatedData = this.validateInvoiceData(invoiceData);\n      const pdfBlob = await this.generatePDF(validatedData);\n      const url = URL.createObjectURL(pdfBlob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `invoice-${invoiceData.orderNumber}.pdf`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n    } catch (error) {\n      console.error('Error downloading invoice:', error);\n      throw error;\n    }\n  }\n\n  public async sendInvoiceEmail(invoiceData: InvoiceData, customerEmail: string): Promise<void> {\n    try {\n      // Validate calculations before generating PDF\n      const validatedData = this.validateInvoiceData(invoiceData);\n      const pdfBlob = await this.generatePDF(validatedData);\n      const base64PDF = await this.blobToBase64(pdfBlob);\n      \n      const templateParams = {\n        to_email: customerEmail,\n        customer_name: invoiceData.customerInfo.name,\n        order_number: invoiceData.orderNumber,\n        total_amount: invoiceData.total.toFixed(3),\n        attachment: base64PDF\n      };\n\n      await emailjs.send(\n        'your_service_id',\n        'your_template_id',\n        templateParams,\n        'your_public_key'\n      );\n    } catch (error) {\n      console.error('Error sending invoice email:', error);\n      throw error;\n    }\n  }\n\n  private blobToBase64(blob: Blob): Promise<string> {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => {\n        const base64 = (reader.result as string).split(',')[1];\n        resolve(base64);\n      };\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    });\n  }\n}\n\nexport default InvoiceService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}