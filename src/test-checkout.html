<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø·Ù„Ø¨ - Q8 Fruit</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #4CAF50, #FFA726);
            direction: rtl;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        h1 {
            color: #4CAF50;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 25px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }
        .test-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            font-size: 18px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #45a049;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            background: #f0f0f0;
            border-left: 4px solid #4CAF50;
        }
        .error {
            border-left-color: #f44336;
            background: #ffebee;
        }
        .success {
            border-left-color: #4CAF50;
            background: #e8f5e8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª - Q8 Fruit</h1>
        
        <div class="test-section">
            <div class="test-title">ğŸ“ Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
            <button onclick="setupTestUser()">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ</button>
            <button onclick="loginTestUser()">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
            <button onclick="logoutTestUser()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
            <div id="userResult" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ›’ Ø¥Ø¹Ø¯Ø§Ø¯ Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</div>
            <button onclick="setupTestCart()">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø³Ù„Ø©</button>
            <button onclick="clearCart()">Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©</button>
            <div id="cartResult" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">âœ… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø·Ù„Ø¨</div>
            <button onclick="testOrderProcess()">Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
            <div id="orderResult" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</div>
            <button onclick="showStoredData()">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <div id="dataResult" class="result" style="display:none;"></div>
        </div>
    </div>

    <script>
        function showResult(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            element.innerHTML = message;
            element.style.display = 'block';
            element.className = `result ${isError ? 'error' : 'success'}`;
        }

        function setupTestUser() {
            try {
                const testUser = {
                    name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
                    email: 'test@example.com',
                    phone: '99887766',
                    address: 'Ø§Ù„ÙØ±ÙˆØ§Ù†ÙŠØ©ØŒ Ø´Ø§Ø±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ',
                    area: 'Ø§Ù„ÙØ±ÙˆØ§Ù†ÙŠØ©',
                    password: '123456',
                    orderCount: 0,
                    totalSpent: 0,
                    joinDate: new Date().toISOString()
                };

                let registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                const existingIndex = registeredUsers.findIndex(user => user.email === testUser.email);
                
                if (existingIndex !== -1) {
                    registeredUsers[existingIndex] = testUser;
                } else {
                    registeredUsers.push(testUser);
                }
                
                localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                showResult('userResult', 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¨Ù†Ø¬Ø§Ø­ âœ…');
            } catch (error) {
                showResult('userResult', `Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${error.message}`, true);
            }
        }

        function loginTestUser() {
            try {
                localStorage.setItem('userLoggedIn', 'true');
                localStorage.setItem('userEmail', 'test@example.com');
                localStorage.setItem('userName', 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯');
                localStorage.setItem('userPhone', '99887766');
                localStorage.setItem('userAddress', 'Ø§Ù„ÙØ±ÙˆØ§Ù†ÙŠØ©ØŒ Ø´Ø§Ø±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ');
                showResult('userResult', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ âœ…');
            } catch (error) {
                showResult('userResult', `Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ${error.message}`, true);
            }
        }

        function logoutTestUser() {
            localStorage.removeItem('userLoggedIn');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('userName');
            localStorage.removeItem('userPhone');
            localStorage.removeItem('userAddress');
            showResult('userResult', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ âœ…');
        }

        function setupTestCart() {
            try {
                const testCart = [
                    {
                        product: {
                            id: 1,
                            name: 'ØªÙØ§Ø­ Ø£Ø­Ù…Ø±',
                            category: 'ÙÙˆØ§ÙƒÙ‡',
                            image: '/images/apple.jpg'
                        },
                        selectedUnit: {
                            unit: 'ÙƒÙŠÙ„Ùˆ',
                            price: 2.5
                        },
                        quantity: 3
                    },
                    {
                        product: {
                            id: 2,
                            name: 'Ù…ÙˆØ²',
                            category: 'ÙÙˆØ§ÙƒÙ‡',
                            image: '/images/banana.jpg'
                        },
                        selectedUnit: {
                            unit: 'ÙƒÙŠÙ„Ùˆ',
                            price: 1.8
                        },
                        quantity: 2
                    }
                ];

                localStorage.setItem('cart', JSON.stringify(testCart));
                showResult('cartResult', `ØªÙ… Ø¥Ø¶Ø§ÙØ© ${testCart.length} Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø© âœ…`);
            } catch (error) {
                showResult('cartResult', `Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù„Ø©: ${error.message}`, true);
            }
        }

        function clearCart() {
            localStorage.removeItem('cart');
            showResult('cartResult', 'ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø© âœ…');
        }

        function testOrderProcess() {
            try {
                const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
                const cart = JSON.parse(localStorage.getItem('cart') || '[]');
                
                if (!isLoggedIn) {
                    showResult('orderResult', 'ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹ âŒ', true);
                    return;
                }

                if (cart.length === 0) {
                    showResult('orderResult', 'Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© - ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø£ÙˆÙ„Ø§Ù‹ âŒ', true);
                    return;
                }

                // Simulate order data
                const orderData = {
                    orderNumber: 'ORD-' + Date.now(),
                    date: new Date().toLocaleDateString('ar-SA'),
                    items: cart,
                    total: cart.reduce((sum, item) => sum + (item.selectedUnit.price * item.quantity), 0) + 2,
                    deliveryPrice: 2,
                    paymentMethod: 'Ù†Ù‚Ø¯ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…',
                    customerInfo: {
                        name: localStorage.getItem('userName'),
                        email: localStorage.getItem('userEmail'),
                        phone: localStorage.getItem('userPhone'),
                        address: localStorage.getItem('userAddress'),
                        area: 'Ø§Ù„ÙØ±ÙˆØ§Ù†ÙŠØ©',
                        notes: 'Ø·Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ'
                    }
                };

                // Test saving order to history
                const userEmail = localStorage.getItem('userEmail');
                const orderHistory = JSON.parse(localStorage.getItem(`orders_${userEmail}`) || '[]');
                
                const newOrder = {
                    id: Date.now().toString(),
                    orderNumber: orderData.orderNumber,
                    date: orderData.date,
                    items: orderData.items.map(item => ({
                        name: item.product.name,
                        quantity: item.quantity,
                        price: item.selectedUnit.price,
                        unit: item.selectedUnit.unit
                    })),
                    total: orderData.total,
                    status: 'pending',
                    paymentMethod: orderData.paymentMethod,
                    deliveryPrice: orderData.deliveryPrice,
                    customerInfo: orderData.customerInfo
                };
                
                orderHistory.unshift(newOrder);
                localStorage.setItem(`orders_${userEmail}`, JSON.stringify(orderHistory));

                // Update user statistics
                const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                const userIndex = registeredUsers.findIndex(user => user.email === userEmail);
                
                if (userIndex !== -1) {
                    registeredUsers[userIndex].orderCount = orderHistory.length;
                    registeredUsers[userIndex].totalSpent = orderHistory.reduce((sum, order) => sum + order.total, 0);
                    localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                }

                // Clear cart
                localStorage.removeItem('cart');

                showResult('orderResult', `ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­! âœ…\nØ±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${orderData.orderNumber}\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${orderData.total} Ø¯.Ùƒ`);
                
            } catch (error) {
                showResult('orderResult', `Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨: ${error.message}`, true);
            }
        }

        function showStoredData() {
            try {
                const data = {
                    userLoggedIn: localStorage.getItem('userLoggedIn'),
                    userEmail: localStorage.getItem('userEmail'),
                    userName: localStorage.getItem('userName'),
                    cart: JSON.parse(localStorage.getItem('cart') || '[]'),
                    registeredUsers: JSON.parse(localStorage.getItem('registeredUsers') || '[]'),
                    orderHistory: localStorage.getItem('userEmail') ? 
                        JSON.parse(localStorage.getItem(`orders_${localStorage.getItem('userEmail')}`) || '[]') : []
                };

                const displayData = JSON.stringify(data, null, 2);
                showResult('dataResult', `<pre>${displayData}</pre>`);
            } catch (error) {
                showResult('dataResult', `Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}`, true);
            }
        }
    </script>
</body>
</html>