{"ast":null,"code":"var _InvoiceService;\nimport jsPDF from 'jspdf';\nimport html2canvas from 'html2canvas';\nimport emailjs from '@emailjs/browser';\nexport class InvoiceService {\n  static getInstance() {\n    if (!InvoiceService.instance) {\n      InvoiceService.instance = new InvoiceService();\n    }\n    return InvoiceService.instance;\n  }\n  getTexts(language) {\n    return {\n      ar: {\n        title: 'فكهاني الكويت',\n        subtitle: 'فاتورة شراء',\n        invoice: 'فاتورة رقم',\n        date: 'التاريخ',\n        customer: 'بيانات العميل',\n        name: 'الاسم',\n        phone: 'الهاتف',\n        address: 'العنوان',\n        area: 'المنطقة',\n        items: 'المنتجات',\n        product: 'المنتج',\n        quantity: 'الكمية',\n        price: 'السعر',\n        total: 'المجموع',\n        subtotal: 'المجموع الفرعي',\n        delivery: 'التوصيل',\n        finalTotal: 'المجموع النهائي',\n        paymentMethod: 'طريقة الدفع',\n        cash: 'دفع نقدي',\n        link: 'دفع إلكتروني',\n        currency: 'د.ك',\n        thankYou: 'شكراً لاختياركم فكهاني الكويت',\n        contact: 'للاستفسار: واتساب 99999999'\n      },\n      en: {\n        title: 'Fakahani Kuwait',\n        subtitle: 'Purchase Invoice',\n        invoice: 'Invoice No.',\n        date: 'Date',\n        customer: 'Customer Information',\n        name: 'Name',\n        phone: 'Phone',\n        address: 'Address',\n        area: 'Area',\n        items: 'Items',\n        product: 'Product',\n        quantity: 'Quantity',\n        price: 'Price',\n        total: 'Total',\n        subtotal: 'Subtotal',\n        delivery: 'Delivery',\n        finalTotal: 'Final Total',\n        paymentMethod: 'Payment Method',\n        cash: 'Cash Payment',\n        link: 'Electronic Payment',\n        currency: 'KWD',\n        thankYou: 'Thank you for choosing Fakahani Kuwait',\n        contact: 'For inquiries: WhatsApp 99999999'\n      }\n    };\n  }\n\n  // Helper method to calculate subtotal from items\n  calculateSubtotal(items) {\n    return items.reduce((sum, item) => sum + item.product.price * item.quantity, 0);\n  }\n\n  // Helper method to validate invoice calculations\n  validateInvoiceData(invoiceData) {\n    const calculatedSubtotal = this.calculateSubtotal(invoiceData.items);\n    const calculatedTotal = calculatedSubtotal + invoiceData.deliveryPrice;\n    return {\n      ...invoiceData,\n      subtotal: calculatedSubtotal,\n      total: calculatedTotal\n    };\n  }\n  createInvoiceHTML(invoiceData) {\n    const texts = this.getTexts(invoiceData.language)[invoiceData.language];\n    const isRTL = invoiceData.language === 'ar';\n    return `\n      <div style=\"\n        width: 800px;\n        font-family: 'Cairo', 'Arial', sans-serif;\n        direction: ${isRTL ? 'rtl' : 'ltr'};\n        background: white;\n        padding: 40px;\n        color: #333;\n      \">\n        <!-- Header -->\n        <div style=\"\n          background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);\n          color: white;\n          padding: 30px;\n          border-radius: 15px;\n          margin-bottom: 30px;\n          text-align: ${isRTL ? 'right' : 'left'};\n        \">\n          <h1 style=\"margin: 0; font-size: 28px; font-weight: bold;\">${texts.title}</h1>\n          <h2 style=\"margin: 5px 0 0 0; font-size: 16px; opacity: 0.9;\">${texts.subtitle}</h2>\n        </div>\n\n        <!-- Invoice Info -->\n        <div style=\"\n          display: flex;\n          justify-content: space-between;\n          margin-bottom: 30px;\n          padding: 20px;\n          background: #f8fafc;\n          border-radius: 10px;\n        \">\n          <div>\n            <p style=\"margin: 0 0 5px 0; font-weight: bold;\">${texts.invoice}: ${invoiceData.orderNumber}</p>\n            <p style=\"margin: 0; color: #666;\">${texts.date}: ${invoiceData.date}</p>\n          </div>\n        </div>\n\n        <!-- Customer Info -->\n        <div style=\"\n          margin-bottom: 30px;\n          padding: 20px;\n          background: #f8fafc;\n          border-radius: 10px;\n        \">\n          <h3 style=\"margin: 0 0 15px 0; color: #1f2937; font-weight: bold;\">${texts.customer}</h3>\n          <div style=\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;\">\n            <p style=\"margin: 0;\"><strong>${texts.name}:</strong> ${invoiceData.customerInfo.name}</p>\n            <p style=\"margin: 0;\"><strong>${texts.phone}:</strong> ${invoiceData.customerInfo.phone}</p>\n            <p style=\"margin: 0;\"><strong>${texts.address}:</strong> ${invoiceData.customerInfo.address}</p>\n            <p style=\"margin: 0;\"><strong>${texts.area}:</strong> ${invoiceData.customerInfo.area}</p>\n          </div>\n        </div>\n\n        <!-- Items Table -->\n        <div style=\"margin-bottom: 30px;\">\n          <h3 style=\"margin: 0 0 15px 0; color: #1f2937; font-weight: bold;\">${texts.items}</h3>\n          <table style=\"\n            width: 100%;\n            border-collapse: collapse;\n            background: white;\n            border-radius: 10px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          \">\n            <thead>\n              <tr style=\"background: #f3f4f6;\">\n                <th style=\"padding: 15px; text-align: ${isRTL ? 'right' : 'left'}; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.product}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.quantity}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.price}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.total}</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${invoiceData.items.map(item => {\n      const itemTotal = item.product.price * item.quantity;\n      const productName = isRTL ? item.product.name.ar || item.product.name.en : item.product.name.en;\n      return `\n                  <tr>\n                    <td style=\"padding: 12px; border-bottom: 1px solid #f3f4f6;\">${productName}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6;\">${item.quantity}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6;\">${item.product.price.toFixed(3)}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6; font-weight: bold; color: #22c55e;\">${itemTotal.toFixed(3)}</td>\n                  </tr>\n                `;\n    }).join('')}\n            </tbody>\n          </table>\n        </div>\n\n        <!-- Totals -->\n        <div style=\"\n          background: #f8fafc;\n          padding: 20px;\n          border-radius: 10px;\n          margin-bottom: 30px;\n        \">\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n            <span>${texts.subtotal}:</span>\n            <span style=\"font-weight: bold;\">${invoiceData.subtotal.toFixed(3)} ${texts.currency}</span>\n          </div>\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n            <span>${texts.delivery}:</span>\n            <span style=\"font-weight: bold;\">${invoiceData.deliveryPrice.toFixed(3)} ${texts.currency}</span>\n          </div>\n          <div style=\"\n            display: flex;\n            justify-content: space-between;\n            padding-top: 10px;\n            border-top: 2px solid #22c55e;\n            font-size: 18px;\n            font-weight: bold;\n            color: #22c55e;\n          \">\n            <span>${texts.finalTotal}:</span>\n            <span>${invoiceData.total.toFixed(3)} ${texts.currency}</span>\n          </div>\n        </div>\n\n        <!-- Payment Method -->\n        <div style=\"\n          background: #f8fafc;\n          padding: 15px;\n          border-radius: 10px;\n          margin-bottom: 30px;\n        \">\n          <p style=\"margin: 0; font-weight: bold;\">\n            ${texts.paymentMethod}: ${invoiceData.paymentMethod === 'cash' ? texts.cash : texts.link}\n          </p>\n        </div>\n\n        <!-- Footer -->\n        <div style=\"\n          text-align: center;\n          padding: 20px;\n          background: #22c55e;\n          color: white;\n          border-radius: 10px;\n        \">\n          <p style=\"margin: 0 0 10px 0; font-size: 16px; font-weight: bold;\">${texts.thankYou}</p>\n          <p style=\"margin: 0; font-size: 14px; opacity: 0.9;\">${texts.contact}</p>\n        </div>\n      </div>\n    `;\n  }\n  async generatePDF(invoiceData) {\n    // Validate and correct calculations\n    const validatedData = this.validateInvoiceData(invoiceData);\n    const htmlContent = this.createInvoiceHTML(validatedData);\n\n    // Create a temporary container\n    const container = document.createElement('div');\n    container.innerHTML = htmlContent;\n    container.style.position = 'absolute';\n    container.style.left = '-9999px';\n    container.style.top = '-9999px';\n\n    // Add to body temporarily\n    document.body.appendChild(container);\n    try {\n      // Generate canvas from HTML\n      const canvas = await html2canvas(container.firstElementChild, {\n        scale: 2,\n        useCORS: true,\n        allowTaint: true,\n        backgroundColor: '#ffffff',\n        width: 800,\n        height: 1200\n      });\n\n      // Create PDF\n      const pdf = new jsPDF({\n        orientation: 'portrait',\n        unit: 'mm',\n        format: 'a4'\n      });\n      const imgData = canvas.toDataURL('image/png');\n      const imgWidth = 210;\n      const pageHeight = 295;\n      const imgHeight = canvas.height * imgWidth / canvas.width;\n      let heightLeft = imgHeight;\n      let position = 0;\n      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n      heightLeft -= pageHeight;\n      while (heightLeft >= 0) {\n        position = heightLeft - imgHeight;\n        pdf.addPage();\n        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n        heightLeft -= pageHeight;\n      }\n      return pdf.output('blob');\n    } finally {\n      // Clean up\n      document.body.removeChild(container);\n    }\n  }\n  async downloadInvoice(invoiceData) {\n    try {\n      // Validate calculations before generating PDF\n      const validatedData = this.validateInvoiceData(invoiceData);\n      const pdfBlob = await this.generatePDF(validatedData);\n      const url = URL.createObjectURL(pdfBlob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `invoice-${invoiceData.orderNumber}.pdf`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n    } catch (error) {\n      console.error('Error downloading invoice:', error);\n      throw error;\n    }\n  }\n  async sendInvoiceEmail(invoiceData, customerEmail) {\n    try {\n      // Validate calculations before generating PDF\n      const validatedData = this.validateInvoiceData(invoiceData);\n      const pdfBlob = await this.generatePDF(validatedData);\n      const base64PDF = await this.blobToBase64(pdfBlob);\n      const templateParams = {\n        to_email: customerEmail,\n        customer_name: invoiceData.customerInfo.name,\n        order_number: invoiceData.orderNumber,\n        total_amount: invoiceData.total.toFixed(3),\n        attachment: base64PDF\n      };\n      await emailjs.send('your_service_id', 'your_template_id', templateParams, 'your_public_key');\n    } catch (error) {\n      console.error('Error sending invoice email:', error);\n      throw error;\n    }\n  }\n  blobToBase64(blob) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => {\n        const base64 = reader.result.split(',')[1];\n        resolve(base64);\n      };\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    });\n  }\n}\n_InvoiceService = InvoiceService;\nInvoiceService.instance = void 0;\nexport default InvoiceService;","map":{"version":3,"names":["jsPDF","html2canvas","emailjs","InvoiceService","getInstance","instance","getTexts","language","ar","title","subtitle","invoice","date","customer","name","phone","address","area","items","product","quantity","price","total","subtotal","delivery","finalTotal","paymentMethod","cash","link","currency","thankYou","contact","en","calculateSubtotal","reduce","sum","item","validateInvoiceData","invoiceData","calculatedSubtotal","calculatedTotal","deliveryPrice","createInvoiceHTML","texts","isRTL","orderNumber","customerInfo","map","itemTotal","productName","toFixed","join","generatePDF","validatedData","htmlContent","container","document","createElement","innerHTML","style","position","left","top","body","appendChild","canvas","firstElementChild","scale","useCORS","allowTaint","backgroundColor","width","height","pdf","orientation","unit","format","imgData","toDataURL","imgWidth","pageHeight","imgHeight","heightLeft","addImage","addPage","output","removeChild","downloadInvoice","pdfBlob","url","URL","createObjectURL","href","download","click","revokeObjectURL","error","console","sendInvoiceEmail","customerEmail","base64PDF","blobToBase64","templateParams","to_email","customer_name","order_number","total_amount","attachment","send","blob","Promise","resolve","reject","reader","FileReader","onload","base64","result","split","onerror","readAsDataURL","_InvoiceService"],"sources":["/Users/mac/Documents/GitHub/fruits/src/services/InvoiceService.ts"],"sourcesContent":["import jsPDF from 'jspdf';\nimport html2canvas from 'html2canvas';\nimport { CartItem, Language } from '../types';\nimport emailjs from '@emailjs/browser';\n\nexport interface InvoiceData {\n  orderNumber: string;\n  date: string;\n  customerInfo: {\n    name: string;\n    phone: string;\n    address: string;\n    area: string;\n  };\n  items: CartItem[];\n  subtotal: number;\n  deliveryPrice: number;\n  total: number;\n  paymentMethod: 'link' | 'cash';\n  language: Language;\n}\n\nexport class InvoiceService {\n  private static instance: InvoiceService;\n\n  public static getInstance(): InvoiceService {\n    if (!InvoiceService.instance) {\n      InvoiceService.instance = new InvoiceService();\n    }\n    return InvoiceService.instance;\n  }\n\n  private getTexts(language: Language) {\n    return {\n      ar: {\n        title: 'فكهاني الكويت',\n        subtitle: 'فاتورة شراء',\n        invoice: 'فاتورة رقم',\n        date: 'التاريخ',\n        customer: 'بيانات العميل',\n        name: 'الاسم',\n        phone: 'الهاتف',\n        address: 'العنوان',\n        area: 'المنطقة',\n        items: 'المنتجات',\n        product: 'المنتج',\n        quantity: 'الكمية',\n        price: 'السعر',\n        total: 'المجموع',\n        subtotal: 'المجموع الفرعي',\n        delivery: 'التوصيل',\n        finalTotal: 'المجموع النهائي',\n        paymentMethod: 'طريقة الدفع',\n        cash: 'دفع نقدي',\n        link: 'دفع إلكتروني',\n        currency: 'د.ك',\n        thankYou: 'شكراً لاختياركم فكهاني الكويت',\n        contact: 'للاستفسار: واتساب 99999999'\n      },\n      en: {\n        title: 'Fakahani Kuwait',\n        subtitle: 'Purchase Invoice',\n        invoice: 'Invoice No.',\n        date: 'Date',\n        customer: 'Customer Information',\n        name: 'Name',\n        phone: 'Phone',\n        address: 'Address',\n        area: 'Area',\n        items: 'Items',\n        product: 'Product',\n        quantity: 'Quantity',\n        price: 'Price',\n        total: 'Total',\n        subtotal: 'Subtotal',\n        delivery: 'Delivery',\n        finalTotal: 'Final Total',\n        paymentMethod: 'Payment Method',\n        cash: 'Cash Payment',\n        link: 'Electronic Payment',\n        currency: 'KWD',\n        thankYou: 'Thank you for choosing Fakahani Kuwait',\n        contact: 'For inquiries: WhatsApp 99999999'\n      }\n    };\n  }\n\n  // Helper method to calculate subtotal from items\n  private calculateSubtotal(items: CartItem[]): number {\n    return items.reduce((sum, item) => sum + (item.product.price * item.quantity), 0);\n  }\n\n  // Helper method to validate invoice calculations\n  private validateInvoiceData(invoiceData: InvoiceData): InvoiceData {\n    const calculatedSubtotal = this.calculateSubtotal(invoiceData.items);\n    const calculatedTotal = calculatedSubtotal + invoiceData.deliveryPrice;\n    \n    return {\n      ...invoiceData,\n      subtotal: calculatedSubtotal,\n      total: calculatedTotal\n    };\n  }\n\n  private createInvoiceHTML(invoiceData: InvoiceData): string {\n    const texts = this.getTexts(invoiceData.language)[invoiceData.language];\n    const isRTL = invoiceData.language === 'ar';\n    \n    return `\n      <div style=\"\n        width: 800px;\n        font-family: 'Cairo', 'Arial', sans-serif;\n        direction: ${isRTL ? 'rtl' : 'ltr'};\n        background: white;\n        padding: 40px;\n        color: #333;\n      \">\n        <!-- Header -->\n        <div style=\"\n          background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);\n          color: white;\n          padding: 30px;\n          border-radius: 15px;\n          margin-bottom: 30px;\n          text-align: ${isRTL ? 'right' : 'left'};\n        \">\n          <h1 style=\"margin: 0; font-size: 28px; font-weight: bold;\">${texts.title}</h1>\n          <h2 style=\"margin: 5px 0 0 0; font-size: 16px; opacity: 0.9;\">${texts.subtitle}</h2>\n        </div>\n\n        <!-- Invoice Info -->\n        <div style=\"\n          display: flex;\n          justify-content: space-between;\n          margin-bottom: 30px;\n          padding: 20px;\n          background: #f8fafc;\n          border-radius: 10px;\n        \">\n          <div>\n            <p style=\"margin: 0 0 5px 0; font-weight: bold;\">${texts.invoice}: ${invoiceData.orderNumber}</p>\n            <p style=\"margin: 0; color: #666;\">${texts.date}: ${invoiceData.date}</p>\n          </div>\n        </div>\n\n        <!-- Customer Info -->\n        <div style=\"\n          margin-bottom: 30px;\n          padding: 20px;\n          background: #f8fafc;\n          border-radius: 10px;\n        \">\n          <h3 style=\"margin: 0 0 15px 0; color: #1f2937; font-weight: bold;\">${texts.customer}</h3>\n          <div style=\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;\">\n            <p style=\"margin: 0;\"><strong>${texts.name}:</strong> ${invoiceData.customerInfo.name}</p>\n            <p style=\"margin: 0;\"><strong>${texts.phone}:</strong> ${invoiceData.customerInfo.phone}</p>\n            <p style=\"margin: 0;\"><strong>${texts.address}:</strong> ${invoiceData.customerInfo.address}</p>\n            <p style=\"margin: 0;\"><strong>${texts.area}:</strong> ${invoiceData.customerInfo.area}</p>\n          </div>\n        </div>\n\n        <!-- Items Table -->\n        <div style=\"margin-bottom: 30px;\">\n          <h3 style=\"margin: 0 0 15px 0; color: #1f2937; font-weight: bold;\">${texts.items}</h3>\n          <table style=\"\n            width: 100%;\n            border-collapse: collapse;\n            background: white;\n            border-radius: 10px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          \">\n            <thead>\n              <tr style=\"background: #f3f4f6;\">\n                <th style=\"padding: 15px; text-align: ${isRTL ? 'right' : 'left'}; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.product}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.quantity}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.price}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.total}</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${invoiceData.items.map(item => {\n                const itemTotal = item.product.price * item.quantity;\n                const productName = isRTL ? (item.product.name.ar || item.product.name.en) : item.product.name.en;\n                return `\n                  <tr>\n                    <td style=\"padding: 12px; border-bottom: 1px solid #f3f4f6;\">${productName}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6;\">${item.quantity}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6;\">${item.product.price.toFixed(3)}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6; font-weight: bold; color: #22c55e;\">${itemTotal.toFixed(3)}</td>\n                  </tr>\n                `;\n              }).join('')}\n            </tbody>\n          </table>\n        </div>\n\n        <!-- Totals -->\n        <div style=\"\n          background: #f8fafc;\n          padding: 20px;\n          border-radius: 10px;\n          margin-bottom: 30px;\n        \">\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n            <span>${texts.subtotal}:</span>\n            <span style=\"font-weight: bold;\">${invoiceData.subtotal.toFixed(3)} ${texts.currency}</span>\n          </div>\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n            <span>${texts.delivery}:</span>\n            <span style=\"font-weight: bold;\">${invoiceData.deliveryPrice.toFixed(3)} ${texts.currency}</span>\n          </div>\n          <div style=\"\n            display: flex;\n            justify-content: space-between;\n            padding-top: 10px;\n            border-top: 2px solid #22c55e;\n            font-size: 18px;\n            font-weight: bold;\n            color: #22c55e;\n          \">\n            <span>${texts.finalTotal}:</span>\n            <span>${invoiceData.total.toFixed(3)} ${texts.currency}</span>\n          </div>\n        </div>\n\n        <!-- Payment Method -->\n        <div style=\"\n          background: #f8fafc;\n          padding: 15px;\n          border-radius: 10px;\n          margin-bottom: 30px;\n        \">\n          <p style=\"margin: 0; font-weight: bold;\">\n            ${texts.paymentMethod}: ${invoiceData.paymentMethod === 'cash' ? texts.cash : texts.link}\n          </p>\n        </div>\n\n        <!-- Footer -->\n        <div style=\"\n          text-align: center;\n          padding: 20px;\n          background: #22c55e;\n          color: white;\n          border-radius: 10px;\n        \">\n          <p style=\"margin: 0 0 10px 0; font-size: 16px; font-weight: bold;\">${texts.thankYou}</p>\n          <p style=\"margin: 0; font-size: 14px; opacity: 0.9;\">${texts.contact}</p>\n        </div>\n      </div>\n    `;\n  }\n\n  public async generatePDF(invoiceData: InvoiceData): Promise<Blob> {\n    // Validate and correct calculations\n    const validatedData = this.validateInvoiceData(invoiceData);\n    const htmlContent = this.createInvoiceHTML(validatedData);\n    \n    // Create a temporary container\n    const container = document.createElement('div');\n    container.innerHTML = htmlContent;\n    container.style.position = 'absolute';\n    container.style.left = '-9999px';\n    container.style.top = '-9999px';\n    \n    // Add to body temporarily\n    document.body.appendChild(container);\n    \n    try {\n      // Generate canvas from HTML\n      const canvas = await html2canvas(container.firstElementChild as HTMLElement, {\n        scale: 2,\n        useCORS: true,\n        allowTaint: true,\n        backgroundColor: '#ffffff',\n        width: 800,\n        height: 1200\n      });\n      \n      // Create PDF\n      const pdf = new jsPDF({\n        orientation: 'portrait',\n        unit: 'mm',\n        format: 'a4'\n      });\n      \n      const imgData = canvas.toDataURL('image/png');\n      const imgWidth = 210;\n      const pageHeight = 295;\n      const imgHeight = (canvas.height * imgWidth) / canvas.width;\n      let heightLeft = imgHeight;\n      \n      let position = 0;\n      \n      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n      heightLeft -= pageHeight;\n      \n      while (heightLeft >= 0) {\n        position = heightLeft - imgHeight;\n        pdf.addPage();\n        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n        heightLeft -= pageHeight;\n      }\n      \n      return pdf.output('blob');\n    } finally {\n      // Clean up\n      document.body.removeChild(container);\n    }\n  }\n\n  public async downloadInvoice(invoiceData: InvoiceData): Promise<void> {\n    try {\n      // Validate calculations before generating PDF\n      const validatedData = this.validateInvoiceData(invoiceData);\n      const pdfBlob = await this.generatePDF(validatedData);\n      const url = URL.createObjectURL(pdfBlob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `invoice-${invoiceData.orderNumber}.pdf`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n    } catch (error) {\n      console.error('Error downloading invoice:', error);\n      throw error;\n    }\n  }\n\n  public async sendInvoiceEmail(invoiceData: InvoiceData, customerEmail: string): Promise<void> {\n    try {\n      // Validate calculations before generating PDF\n      const validatedData = this.validateInvoiceData(invoiceData);\n      const pdfBlob = await this.generatePDF(validatedData);\n      const base64PDF = await this.blobToBase64(pdfBlob);\n      \n      const templateParams = {\n        to_email: customerEmail,\n        customer_name: invoiceData.customerInfo.name,\n        order_number: invoiceData.orderNumber,\n        total_amount: invoiceData.total.toFixed(3),\n        attachment: base64PDF\n      };\n\n      await emailjs.send(\n        'your_service_id',\n        'your_template_id',\n        templateParams,\n        'your_public_key'\n      );\n    } catch (error) {\n      console.error('Error sending invoice email:', error);\n      throw error;\n    }\n  }\n\n  private blobToBase64(blob: Blob): Promise<string> {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => {\n        const base64 = (reader.result as string).split(',')[1];\n        resolve(base64);\n      };\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    });\n  }\n}\n\nexport default InvoiceService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}