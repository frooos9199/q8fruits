{"ast":null,"code":"import _objectSpread from\"/Users/mac/Documents/GitHub/fruits/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";var _InvoiceService;import jsPDF from'jspdf';import html2canvas from'html2canvas';import emailjs from'@emailjs/browser';export class InvoiceService{static getInstance(){if(!InvoiceService.instance){InvoiceService.instance=new InvoiceService();}return InvoiceService.instance;}getTexts(language){return{ar:{title:'فكهاني الكويت',subtitle:'فاتورة شراء',invoice:'فاتورة رقم',date:'التاريخ',customer:'بيانات العميل',name:'الاسم',phone:'الهاتف',address:'العنوان',area:'المحافظة',items:'المنتجات',product:'المنتج',quantity:'الكمية',price:'السعر',total:'المجموع',subtotal:'المجموع الفرعي',delivery:'التوصيل',finalTotal:'المجموع النهائي',paymentMethod:'طريقة الدفع',cash:'دفع نقدي',link:'دفع إلكتروني',currency:'د.ك',thankYou:'شكراً لاختياركم فكهاني الكويت',contact:'للاستفسار: واتساب 99999999'},en:{title:'Fakahani Kuwait',subtitle:'Purchase Invoice',invoice:'Invoice No.',date:'Date',customer:'Customer Information',name:'Name',phone:'Phone',address:'Address',area:'Area',items:'Items',product:'Product',quantity:'Quantity',price:'Price',total:'Total',subtotal:'Subtotal',delivery:'Delivery',finalTotal:'Final Total',paymentMethod:'Payment Method',cash:'Cash Payment',link:'Electronic Payment',currency:'KWD',thankYou:'Thank you for choosing Fakahani Kuwait',contact:'For inquiries: WhatsApp 99999999'}};}// Helper method to calculate subtotal from items\ncalculateSubtotal(items){return items.reduce((sum,item)=>sum+item.product.price*item.quantity,0);}// Helper method to validate invoice calculations\nvalidateInvoiceData(invoiceData){const calculatedSubtotal=this.calculateSubtotal(invoiceData.items);const calculatedTotal=calculatedSubtotal+invoiceData.deliveryPrice;return _objectSpread(_objectSpread({},invoiceData),{},{subtotal:calculatedSubtotal,total:calculatedTotal});}createInvoiceHTML(invoiceData){const texts=this.getTexts(invoiceData.language)[invoiceData.language];const isRTL=invoiceData.language==='ar';return\"\\n      <div style=\\\"\\n        width: 800px;\\n        font-family: 'Cairo', 'Arial', sans-serif;\\n        direction: \".concat(isRTL?'rtl':'ltr',\";\\n        background: white;\\n        padding: 40px;\\n        color: #333;\\n      \\\">\\n        <!-- Header -->\\n        <div style=\\\"\\n          background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);\\n          color: white;\\n          padding: 30px;\\n          border-radius: 15px;\\n          margin-bottom: 30px;\\n          text-align: \").concat(isRTL?'right':'left',\";\\n        \\\">\\n          <h1 style=\\\"margin: 0; font-size: 28px; font-weight: bold;\\\">\").concat(texts.title,\"</h1>\\n          <h2 style=\\\"margin: 5px 0 0 0; font-size: 16px; opacity: 0.9;\\\">\").concat(texts.subtitle,\"</h2>\\n        </div>\\n\\n        <!-- Invoice Info -->\\n        <div style=\\\"\\n          display: flex;\\n          justify-content: space-between;\\n          margin-bottom: 30px;\\n          padding: 20px;\\n          background: #f8fafc;\\n          border-radius: 10px;\\n        \\\">\\n          <div>\\n            <p style=\\\"margin: 0 0 5px 0; font-weight: bold;\\\">\").concat(texts.invoice,\": \").concat(invoiceData.orderNumber,\"</p>\\n            <p style=\\\"margin: 0; color: #666;\\\">\").concat(texts.date,\": \").concat(invoiceData.date,\"</p>\\n          </div>\\n        </div>\\n\\n        <!-- Customer Info -->\\n        <div style=\\\"\\n          margin-bottom: 30px;\\n          padding: 20px;\\n          background: #f8fafc;\\n          border-radius: 10px;\\n        \\\">\\n          <h3 style=\\\"margin: 0 0 15px 0; color: #1f2937; font-weight: bold;\\\">\").concat(texts.customer,\"</h3>\\n          <div style=\\\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;\\\">\\n            <p style=\\\"margin: 0;\\\"><strong>\").concat(texts.name,\":</strong> \").concat(invoiceData.customerInfo.name,\"</p>\\n            <p style=\\\"margin: 0;\\\"><strong>\").concat(texts.phone,\":</strong> \").concat(invoiceData.customerInfo.phone,\"</p>\\n            <p style=\\\"margin: 0;\\\"><strong>\").concat(texts.address,\":</strong> \").concat(invoiceData.customerInfo.address,\"</p>\\n            <p style=\\\"margin: 0;\\\"><strong>\").concat(texts.area,\":</strong> \").concat(invoiceData.customerInfo.area,\"</p>\\n          </div>\\n        </div>\\n\\n        <!-- Items Table -->\\n        <div style=\\\"margin-bottom: 30px;\\\">\\n          <h3 style=\\\"margin: 0 0 15px 0; color: #1f2937; font-weight: bold;\\\">\").concat(texts.items,\"</h3>\\n          <table style=\\\"\\n            width: 100%;\\n            border-collapse: collapse;\\n            background: white;\\n            border-radius: 10px;\\n            overflow: hidden;\\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\\n          \\\">\\n            <thead>\\n              <tr style=\\\"background: #f3f4f6;\\\">\\n                <th style=\\\"padding: 15px; text-align: \").concat(isRTL?'right':'left',\"; font-weight: bold; border-bottom: 1px solid #e5e7eb;\\\">\").concat(texts.product,\"</th>\\n                <th style=\\\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\\\">\").concat(texts.quantity,\"</th>\\n                <th style=\\\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\\\">\").concat(texts.price,\"</th>\\n                <th style=\\\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\\\">\").concat(texts.total,\"</th>\\n              </tr>\\n            </thead>\\n            <tbody>\\n              \").concat(invoiceData.items.map(item=>{const itemTotal=item.product.price*item.quantity;const productName=isRTL?item.product.name.ar||item.product.name.en:item.product.name.en;return\"\\n                  <tr>\\n                    <td style=\\\"padding: 12px; border-bottom: 1px solid #f3f4f6;\\\">\".concat(productName,\"</td>\\n                    <td style=\\\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6;\\\">\").concat(item.quantity,\"</td>\\n                    <td style=\\\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6;\\\">\").concat(item.product.price.toFixed(3),\"</td>\\n                    <td style=\\\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6; font-weight: bold; color: #22c55e;\\\">\").concat(itemTotal.toFixed(3),\"</td>\\n                  </tr>\\n                \");}).join(''),\"\\n            </tbody>\\n          </table>\\n        </div>\\n\\n        <!-- Totals -->\\n        <div style=\\\"\\n          background: #f8fafc;\\n          padding: 20px;\\n          border-radius: 10px;\\n          margin-bottom: 30px;\\n        \\\">\\n          <div style=\\\"display: flex; justify-content: space-between; margin-bottom: 10px;\\\">\\n            <span>\").concat(texts.subtotal,\":</span>\\n            <span style=\\\"font-weight: bold;\\\">\").concat(invoiceData.subtotal.toFixed(3),\" \").concat(texts.currency,\"</span>\\n          </div>\\n          <div style=\\\"display: flex; justify-content: space-between; margin-bottom: 10px;\\\">\\n            <span>\").concat(texts.delivery,\":</span>\\n            <span style=\\\"font-weight: bold;\\\">\").concat(invoiceData.deliveryPrice.toFixed(3),\" \").concat(texts.currency,\"</span>\\n          </div>\\n          <div style=\\\"\\n            display: flex;\\n            justify-content: space-between;\\n            padding-top: 10px;\\n            border-top: 2px solid #22c55e;\\n            font-size: 18px;\\n            font-weight: bold;\\n            color: #22c55e;\\n          \\\">\\n            <span>\").concat(texts.finalTotal,\":</span>\\n            <span>\").concat(invoiceData.total.toFixed(3),\" \").concat(texts.currency,\"</span>\\n          </div>\\n        </div>\\n\\n        <!-- Payment Method -->\\n        <div style=\\\"\\n          background: #f8fafc;\\n          padding: 15px;\\n          border-radius: 10px;\\n          margin-bottom: 30px;\\n        \\\">\\n          <p style=\\\"margin: 0; font-weight: bold;\\\">\\n            \").concat(texts.paymentMethod,\": \").concat(invoiceData.paymentMethod==='cash'?texts.cash:texts.link,\"\\n          </p>\\n        </div>\\n\\n        <!-- Footer -->\\n        <div style=\\\"\\n          text-align: center;\\n          padding: 20px;\\n          background: #22c55e;\\n          color: white;\\n          border-radius: 10px;\\n        \\\">\\n          <p style=\\\"margin: 0 0 10px 0; font-size: 16px; font-weight: bold;\\\">\").concat(texts.thankYou,\"</p>\\n          <p style=\\\"margin: 0; font-size: 14px; opacity: 0.9;\\\">\").concat(texts.contact,\"</p>\\n        </div>\\n      </div>\\n    \");}async generatePDF(invoiceData){// Validate and correct calculations\nconst validatedData=this.validateInvoiceData(invoiceData);const htmlContent=this.createInvoiceHTML(validatedData);// Create a temporary container\nconst container=document.createElement('div');container.innerHTML=htmlContent;container.style.position='absolute';container.style.left='-9999px';container.style.top='-9999px';// Add to body temporarily\ndocument.body.appendChild(container);try{// Generate canvas from HTML\nconst canvas=await html2canvas(container.firstElementChild,{scale:2,useCORS:true,allowTaint:true,backgroundColor:'#ffffff',width:800,height:1200});// Create PDF\nconst pdf=new jsPDF({orientation:'portrait',unit:'mm',format:'a4'});const imgData=canvas.toDataURL('image/png');const imgWidth=210;const pageHeight=295;const imgHeight=canvas.height*imgWidth/canvas.width;let heightLeft=imgHeight;let position=0;pdf.addImage(imgData,'PNG',0,position,imgWidth,imgHeight);heightLeft-=pageHeight;while(heightLeft>=0){position=heightLeft-imgHeight;pdf.addPage();pdf.addImage(imgData,'PNG',0,position,imgWidth,imgHeight);heightLeft-=pageHeight;}return pdf.output('blob');}finally{// Clean up\ndocument.body.removeChild(container);}}async downloadInvoice(invoiceData){try{// Validate calculations before generating PDF\nconst validatedData=this.validateInvoiceData(invoiceData);const pdfBlob=await this.generatePDF(validatedData);const url=URL.createObjectURL(pdfBlob);const link=document.createElement('a');link.href=url;link.download=\"invoice-\".concat(invoiceData.orderNumber,\".pdf\");document.body.appendChild(link);link.click();document.body.removeChild(link);URL.revokeObjectURL(url);}catch(error){console.error('Error downloading invoice:',error);throw error;}}async sendInvoiceEmail(invoiceData,customerEmail){try{// Validate calculations before generating PDF\nconst validatedData=this.validateInvoiceData(invoiceData);const pdfBlob=await this.generatePDF(validatedData);const base64PDF=await this.blobToBase64(pdfBlob);const templateParams={to_email:customerEmail,customer_name:invoiceData.customerInfo.name,order_number:invoiceData.orderNumber,total_amount:invoiceData.total.toFixed(3),attachment:base64PDF};await emailjs.send('your_service_id','your_template_id',templateParams,'your_public_key');}catch(error){console.error('Error sending invoice email:',error);throw error;}}blobToBase64(blob){return new Promise((resolve,reject)=>{const reader=new FileReader();reader.onload=()=>{const base64=reader.result.split(',')[1];resolve(base64);};reader.onerror=reject;reader.readAsDataURL(blob);});}}_InvoiceService=InvoiceService;InvoiceService.instance=void 0;export default InvoiceService;","map":{"version":3,"names":["jsPDF","html2canvas","emailjs","InvoiceService","getInstance","instance","getTexts","language","ar","title","subtitle","invoice","date","customer","name","phone","address","area","items","product","quantity","price","total","subtotal","delivery","finalTotal","paymentMethod","cash","link","currency","thankYou","contact","en","calculateSubtotal","reduce","sum","item","validateInvoiceData","invoiceData","calculatedSubtotal","calculatedTotal","deliveryPrice","_objectSpread","createInvoiceHTML","texts","isRTL","concat","orderNumber","customerInfo","map","itemTotal","productName","toFixed","join","generatePDF","validatedData","htmlContent","container","document","createElement","innerHTML","style","position","left","top","body","appendChild","canvas","firstElementChild","scale","useCORS","allowTaint","backgroundColor","width","height","pdf","orientation","unit","format","imgData","toDataURL","imgWidth","pageHeight","imgHeight","heightLeft","addImage","addPage","output","removeChild","downloadInvoice","pdfBlob","url","URL","createObjectURL","href","download","click","revokeObjectURL","error","console","sendInvoiceEmail","customerEmail","base64PDF","blobToBase64","templateParams","to_email","customer_name","order_number","total_amount","attachment","send","blob","Promise","resolve","reject","reader","FileReader","onload","base64","result","split","onerror","readAsDataURL","_InvoiceService"],"sources":["/Users/mac/Documents/GitHub/fruits/src/services/InvoiceService.ts"],"sourcesContent":["import jsPDF from 'jspdf';\nimport html2canvas from 'html2canvas';\nimport { CartItem, Language } from '../types';\nimport emailjs from '@emailjs/browser';\n\nexport interface InvoiceData {\n  orderNumber: string;\n  date: string;\n  customerInfo: {\n    name: string;\n    phone: string;\n    address: string;\n    area: string;\n  };\n  items: CartItem[];\n  subtotal: number;\n  deliveryPrice: number;\n  total: number;\n  paymentMethod: 'link' | 'cash';\n  language: Language;\n}\n\nexport class InvoiceService {\n  private static instance: InvoiceService;\n\n  public static getInstance(): InvoiceService {\n    if (!InvoiceService.instance) {\n      InvoiceService.instance = new InvoiceService();\n    }\n    return InvoiceService.instance;\n  }\n\n  private getTexts(language: Language) {\n    return {\n      ar: {\n        title: 'فكهاني الكويت',\n        subtitle: 'فاتورة شراء',\n        invoice: 'فاتورة رقم',\n        date: 'التاريخ',\n        customer: 'بيانات العميل',\n        name: 'الاسم',\n        phone: 'الهاتف',\n        address: 'العنوان',\n        area: 'المحافظة',\n        items: 'المنتجات',\n        product: 'المنتج',\n        quantity: 'الكمية',\n        price: 'السعر',\n        total: 'المجموع',\n        subtotal: 'المجموع الفرعي',\n        delivery: 'التوصيل',\n        finalTotal: 'المجموع النهائي',\n        paymentMethod: 'طريقة الدفع',\n        cash: 'دفع نقدي',\n        link: 'دفع إلكتروني',\n        currency: 'د.ك',\n        thankYou: 'شكراً لاختياركم فكهاني الكويت',\n        contact: 'للاستفسار: واتساب 99999999'\n      },\n      en: {\n        title: 'Fakahani Kuwait',\n        subtitle: 'Purchase Invoice',\n        invoice: 'Invoice No.',\n        date: 'Date',\n        customer: 'Customer Information',\n        name: 'Name',\n        phone: 'Phone',\n        address: 'Address',\n        area: 'Area',\n        items: 'Items',\n        product: 'Product',\n        quantity: 'Quantity',\n        price: 'Price',\n        total: 'Total',\n        subtotal: 'Subtotal',\n        delivery: 'Delivery',\n        finalTotal: 'Final Total',\n        paymentMethod: 'Payment Method',\n        cash: 'Cash Payment',\n        link: 'Electronic Payment',\n        currency: 'KWD',\n        thankYou: 'Thank you for choosing Fakahani Kuwait',\n        contact: 'For inquiries: WhatsApp 99999999'\n      }\n    };\n  }\n\n  // Helper method to calculate subtotal from items\n  private calculateSubtotal(items: CartItem[]): number {\n    return items.reduce((sum, item) => sum + (item.product.price * item.quantity), 0);\n  }\n\n  // Helper method to validate invoice calculations\n  private validateInvoiceData(invoiceData: InvoiceData): InvoiceData {\n    const calculatedSubtotal = this.calculateSubtotal(invoiceData.items);\n    const calculatedTotal = calculatedSubtotal + invoiceData.deliveryPrice;\n    \n    return {\n      ...invoiceData,\n      subtotal: calculatedSubtotal,\n      total: calculatedTotal\n    };\n  }\n\n  private createInvoiceHTML(invoiceData: InvoiceData): string {\n    const texts = this.getTexts(invoiceData.language)[invoiceData.language];\n    const isRTL = invoiceData.language === 'ar';\n    \n    return `\n      <div style=\"\n        width: 800px;\n        font-family: 'Cairo', 'Arial', sans-serif;\n        direction: ${isRTL ? 'rtl' : 'ltr'};\n        background: white;\n        padding: 40px;\n        color: #333;\n      \">\n        <!-- Header -->\n        <div style=\"\n          background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);\n          color: white;\n          padding: 30px;\n          border-radius: 15px;\n          margin-bottom: 30px;\n          text-align: ${isRTL ? 'right' : 'left'};\n        \">\n          <h1 style=\"margin: 0; font-size: 28px; font-weight: bold;\">${texts.title}</h1>\n          <h2 style=\"margin: 5px 0 0 0; font-size: 16px; opacity: 0.9;\">${texts.subtitle}</h2>\n        </div>\n\n        <!-- Invoice Info -->\n        <div style=\"\n          display: flex;\n          justify-content: space-between;\n          margin-bottom: 30px;\n          padding: 20px;\n          background: #f8fafc;\n          border-radius: 10px;\n        \">\n          <div>\n            <p style=\"margin: 0 0 5px 0; font-weight: bold;\">${texts.invoice}: ${invoiceData.orderNumber}</p>\n            <p style=\"margin: 0; color: #666;\">${texts.date}: ${invoiceData.date}</p>\n          </div>\n        </div>\n\n        <!-- Customer Info -->\n        <div style=\"\n          margin-bottom: 30px;\n          padding: 20px;\n          background: #f8fafc;\n          border-radius: 10px;\n        \">\n          <h3 style=\"margin: 0 0 15px 0; color: #1f2937; font-weight: bold;\">${texts.customer}</h3>\n          <div style=\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;\">\n            <p style=\"margin: 0;\"><strong>${texts.name}:</strong> ${invoiceData.customerInfo.name}</p>\n            <p style=\"margin: 0;\"><strong>${texts.phone}:</strong> ${invoiceData.customerInfo.phone}</p>\n            <p style=\"margin: 0;\"><strong>${texts.address}:</strong> ${invoiceData.customerInfo.address}</p>\n            <p style=\"margin: 0;\"><strong>${texts.area}:</strong> ${invoiceData.customerInfo.area}</p>\n          </div>\n        </div>\n\n        <!-- Items Table -->\n        <div style=\"margin-bottom: 30px;\">\n          <h3 style=\"margin: 0 0 15px 0; color: #1f2937; font-weight: bold;\">${texts.items}</h3>\n          <table style=\"\n            width: 100%;\n            border-collapse: collapse;\n            background: white;\n            border-radius: 10px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          \">\n            <thead>\n              <tr style=\"background: #f3f4f6;\">\n                <th style=\"padding: 15px; text-align: ${isRTL ? 'right' : 'left'}; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.product}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.quantity}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.price}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.total}</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${invoiceData.items.map(item => {\n                const itemTotal = item.product.price * item.quantity;\n                const productName = isRTL ? (item.product.name.ar || item.product.name.en) : item.product.name.en;\n                return `\n                  <tr>\n                    <td style=\"padding: 12px; border-bottom: 1px solid #f3f4f6;\">${productName}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6;\">${item.quantity}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6;\">${item.product.price.toFixed(3)}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6; font-weight: bold; color: #22c55e;\">${itemTotal.toFixed(3)}</td>\n                  </tr>\n                `;\n              }).join('')}\n            </tbody>\n          </table>\n        </div>\n\n        <!-- Totals -->\n        <div style=\"\n          background: #f8fafc;\n          padding: 20px;\n          border-radius: 10px;\n          margin-bottom: 30px;\n        \">\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n            <span>${texts.subtotal}:</span>\n            <span style=\"font-weight: bold;\">${invoiceData.subtotal.toFixed(3)} ${texts.currency}</span>\n          </div>\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n            <span>${texts.delivery}:</span>\n            <span style=\"font-weight: bold;\">${invoiceData.deliveryPrice.toFixed(3)} ${texts.currency}</span>\n          </div>\n          <div style=\"\n            display: flex;\n            justify-content: space-between;\n            padding-top: 10px;\n            border-top: 2px solid #22c55e;\n            font-size: 18px;\n            font-weight: bold;\n            color: #22c55e;\n          \">\n            <span>${texts.finalTotal}:</span>\n            <span>${invoiceData.total.toFixed(3)} ${texts.currency}</span>\n          </div>\n        </div>\n\n        <!-- Payment Method -->\n        <div style=\"\n          background: #f8fafc;\n          padding: 15px;\n          border-radius: 10px;\n          margin-bottom: 30px;\n        \">\n          <p style=\"margin: 0; font-weight: bold;\">\n            ${texts.paymentMethod}: ${invoiceData.paymentMethod === 'cash' ? texts.cash : texts.link}\n          </p>\n        </div>\n\n        <!-- Footer -->\n        <div style=\"\n          text-align: center;\n          padding: 20px;\n          background: #22c55e;\n          color: white;\n          border-radius: 10px;\n        \">\n          <p style=\"margin: 0 0 10px 0; font-size: 16px; font-weight: bold;\">${texts.thankYou}</p>\n          <p style=\"margin: 0; font-size: 14px; opacity: 0.9;\">${texts.contact}</p>\n        </div>\n      </div>\n    `;\n  }\n\n  public async generatePDF(invoiceData: InvoiceData): Promise<Blob> {\n    // Validate and correct calculations\n    const validatedData = this.validateInvoiceData(invoiceData);\n    const htmlContent = this.createInvoiceHTML(validatedData);\n    \n    // Create a temporary container\n    const container = document.createElement('div');\n    container.innerHTML = htmlContent;\n    container.style.position = 'absolute';\n    container.style.left = '-9999px';\n    container.style.top = '-9999px';\n    \n    // Add to body temporarily\n    document.body.appendChild(container);\n    \n    try {\n      // Generate canvas from HTML\n      const canvas = await html2canvas(container.firstElementChild as HTMLElement, {\n        scale: 2,\n        useCORS: true,\n        allowTaint: true,\n        backgroundColor: '#ffffff',\n        width: 800,\n        height: 1200\n      });\n      \n      // Create PDF\n      const pdf = new jsPDF({\n        orientation: 'portrait',\n        unit: 'mm',\n        format: 'a4'\n      });\n      \n      const imgData = canvas.toDataURL('image/png');\n      const imgWidth = 210;\n      const pageHeight = 295;\n      const imgHeight = (canvas.height * imgWidth) / canvas.width;\n      let heightLeft = imgHeight;\n      \n      let position = 0;\n      \n      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n      heightLeft -= pageHeight;\n      \n      while (heightLeft >= 0) {\n        position = heightLeft - imgHeight;\n        pdf.addPage();\n        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n        heightLeft -= pageHeight;\n      }\n      \n      return pdf.output('blob');\n    } finally {\n      // Clean up\n      document.body.removeChild(container);\n    }\n  }\n\n  public async downloadInvoice(invoiceData: InvoiceData): Promise<void> {\n    try {\n      // Validate calculations before generating PDF\n      const validatedData = this.validateInvoiceData(invoiceData);\n      const pdfBlob = await this.generatePDF(validatedData);\n      const url = URL.createObjectURL(pdfBlob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `invoice-${invoiceData.orderNumber}.pdf`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n    } catch (error) {\n      console.error('Error downloading invoice:', error);\n      throw error;\n    }\n  }\n\n  public async sendInvoiceEmail(invoiceData: InvoiceData, customerEmail: string): Promise<void> {\n    try {\n      // Validate calculations before generating PDF\n      const validatedData = this.validateInvoiceData(invoiceData);\n      const pdfBlob = await this.generatePDF(validatedData);\n      const base64PDF = await this.blobToBase64(pdfBlob);\n      \n      const templateParams = {\n        to_email: customerEmail,\n        customer_name: invoiceData.customerInfo.name,\n        order_number: invoiceData.orderNumber,\n        total_amount: invoiceData.total.toFixed(3),\n        attachment: base64PDF\n      };\n\n      await emailjs.send(\n        'your_service_id',\n        'your_template_id',\n        templateParams,\n        'your_public_key'\n      );\n    } catch (error) {\n      console.error('Error sending invoice email:', error);\n      throw error;\n    }\n  }\n\n  private blobToBase64(blob: Blob): Promise<string> {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => {\n        const base64 = (reader.result as string).split(',')[1];\n        resolve(base64);\n      };\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    });\n  }\n}\n\nexport default InvoiceService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}