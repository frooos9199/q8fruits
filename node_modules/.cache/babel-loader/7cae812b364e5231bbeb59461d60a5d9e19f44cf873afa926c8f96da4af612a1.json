{"ast":null,"code":"import _objectSpread from\"/Users/mac/Documents/GitHub/fruits/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";var _InvoiceService;import jsPDF from'jspdf';import html2canvas from'html2canvas';import emailjs from'@emailjs/browser';export class InvoiceService{static getInstance(){if(!InvoiceService.instance){InvoiceService.instance=new InvoiceService();}return InvoiceService.instance;}getTexts(language){return{ar:{title:'فكهاني الكويت',subtitle:'فاتورة شراء',invoice:'فاتورة رقم',date:'التاريخ',customer:'بيانات العميل',name:'الاسم',phone:'الهاتف',address:'العنوان',area:'المحافظة',notes:'ملاحظات',items:'المنتجات',product:'المنتج',quantity:'الكمية',price:'السعر',total:'المجموع',subtotal:'المجموع الفرعي',delivery:'التوصيل',finalTotal:'المجموع النهائي',paymentMethod:'طريقة الدفع',cash:'دفع نقدي',link:'دفع إلكتروني',currency:'د.ك',thankYou:'شكراً لاختياركم فكهاني الكويت',contact:'للاستفسار: واتساب 99999999'},en:{title:'Fakahani Kuwait',subtitle:'Purchase Invoice',invoice:'Invoice No.',date:'Date',customer:'Customer Information',name:'Name',phone:'Phone',address:'Address',area:'Area',notes:'Notes',items:'Items',product:'Product',quantity:'Quantity',price:'Price',total:'Total',subtotal:'Subtotal',delivery:'Delivery',finalTotal:'Final Total',paymentMethod:'Payment Method',cash:'Cash Payment',link:'Electronic Payment',currency:'KWD',thankYou:'Thank you for choosing Fakahani Kuwait',contact:'For inquiries: WhatsApp 99999999'}};}// Helper method to calculate subtotal from items\ncalculateSubtotal(items){return items.reduce((sum,item)=>sum+item.selectedUnit.price*item.quantity,0);}// Helper method to validate invoice calculations\nvalidateInvoiceData(invoiceData){const calculatedSubtotal=this.calculateSubtotal(invoiceData.items);const calculatedTotal=calculatedSubtotal+invoiceData.deliveryPrice;return _objectSpread(_objectSpread({},invoiceData),{},{subtotal:calculatedSubtotal,total:calculatedTotal});}createInvoiceHTML(invoiceData){const texts=this.getTexts(invoiceData.language)[invoiceData.language];const isRTL=invoiceData.language==='ar';return\"\\n      <div style=\\\"\\n        width: 800px;\\n        font-family: 'Cairo', 'Arial', sans-serif;\\n        direction: \".concat(isRTL?'rtl':'ltr',\";\\n        background: white;\\n        padding: 40px;\\n        color: #333;\\n      \\\">\\n        <!-- Header -->\\n        <div style=\\\"\\n          background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);\\n          color: white;\\n          padding: 30px;\\n          border-radius: 15px;\\n          margin-bottom: 30px;\\n          text-align: \").concat(isRTL?'right':'left',\";\\n        \\\">\\n          <h1 style=\\\"margin: 0; font-size: 28px; font-weight: bold;\\\">\").concat(texts.title,\"</h1>\\n          <h2 style=\\\"margin: 5px 0 0 0; font-size: 16px; opacity: 0.9;\\\">\").concat(texts.subtitle,\"</h2>\\n        </div>\\n\\n        <!-- Invoice Info -->\\n        <div style=\\\"\\n          display: flex;\\n          justify-content: space-between;\\n          margin-bottom: 30px;\\n          padding: 20px;\\n          background: #f8fafc;\\n          border-radius: 10px;\\n        \\\">\\n          <div>\\n            <p style=\\\"margin: 0 0 5px 0; font-weight: bold;\\\">\").concat(texts.invoice,\": \").concat(invoiceData.orderNumber,\"</p>\\n            <p style=\\\"margin: 0; color: #666;\\\">\").concat(texts.date,\": \").concat(invoiceData.date,\"</p>\\n          </div>\\n        </div>\\n\\n        <!-- Customer Info -->\\n        <div style=\\\"\\n          margin-bottom: 30px;\\n          padding: 20px;\\n          background: #f8fafc;\\n          border-radius: 10px;\\n        \\\">\\n          <h3 style=\\\"margin: 0 0 15px 0; color: #1f2937; font-weight: bold;\\\">\").concat(texts.customer,\"</h3>\\n          <div style=\\\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;\\\">\\n            <p style=\\\"margin: 0;\\\"><strong>\").concat(texts.name,\":</strong> \").concat(invoiceData.customerInfo.name,\"</p>\\n            <p style=\\\"margin: 0;\\\"><strong>\").concat(texts.phone,\":</strong> \").concat(invoiceData.customerInfo.phone,\"</p>\\n            <p style=\\\"margin: 0;\\\"><strong>\").concat(texts.address,\":</strong> \").concat(invoiceData.customerInfo.address,\"</p>\\n            <p style=\\\"margin: 0;\\\"><strong>\").concat(texts.area,\":</strong> \").concat(invoiceData.customerInfo.area,\"</p>\\n          </div>\\n          \").concat(invoiceData.customerInfo.notes?\"\\n          <div style=\\\"margin-top: 15px; padding: 15px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;\\\">\\n            <p style=\\\"margin: 0; font-weight: bold; color: #0f172a;\\\">\".concat(texts.notes,\":</p>\\n            <p style=\\\"margin: 5px 0 0 0; color: #374151;\\\">\").concat(invoiceData.customerInfo.notes,\"</p>\\n          </div>\\n          \"):'',\"\\n        </div>\\n\\n        <!-- Items Table -->\\n        <div style=\\\"margin-bottom: 30px;\\\">\\n          <h3 style=\\\"margin: 0 0 15px 0; color: #1f2937; font-weight: bold;\\\">\").concat(texts.items,\"</h3>\\n          <table style=\\\"\\n            width: 100%;\\n            border-collapse: collapse;\\n            background: white;\\n            border-radius: 10px;\\n            overflow: hidden;\\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\\n          \\\">\\n            <thead>\\n              <tr style=\\\"background: #f3f4f6;\\\">\\n                <th style=\\\"padding: 15px; text-align: \").concat(isRTL?'right':'left',\"; font-weight: bold; border-bottom: 1px solid #e5e7eb;\\\">\").concat(texts.product,\"</th>\\n                <th style=\\\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\\\">\").concat(texts.quantity,\"</th>\\n                <th style=\\\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\\\">\").concat(texts.price,\"</th>\\n                <th style=\\\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\\\">\").concat(texts.total,\"</th>\\n              </tr>\\n            </thead>\\n            <tbody>\\n              \").concat(invoiceData.items.map(item=>{const itemTotal=item.selectedUnit.price*item.quantity;const productName=isRTL?item.product.name.ar||item.product.name.en:item.product.name.en;const unitText=isRTL?item.selectedUnit.unit.ar:item.selectedUnit.unit.en;return\"\\n                  <tr>\\n                    <td style=\\\"padding: 12px; border-bottom: 1px solid #f3f4f6;\\\">\".concat(productName,\"</td>\\n                    <td style=\\\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6;\\\">\").concat(item.quantity,\" \").concat(unitText,\"</td>\\n                    <td style=\\\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6;\\\">\").concat(item.selectedUnit.price.toFixed(3),\"</td>\\n                    <td style=\\\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6; font-weight: bold; color: #22c55e;\\\">\").concat(itemTotal.toFixed(3),\"</td>\\n                  </tr>\\n                \");}).join(''),\"\\n            </tbody>\\n          </table>\\n        </div>\\n\\n        <!-- Totals -->\\n        <div style=\\\"\\n          background: #f8fafc;\\n          padding: 20px;\\n          border-radius: 10px;\\n          margin-bottom: 30px;\\n        \\\">\\n          <div style=\\\"display: flex; justify-content: space-between; margin-bottom: 10px;\\\">\\n            <span>\").concat(texts.subtotal,\":</span>\\n            <span style=\\\"font-weight: bold;\\\">\").concat(invoiceData.subtotal.toFixed(3),\" \").concat(texts.currency,\"</span>\\n          </div>\\n          <div style=\\\"display: flex; justify-content: space-between; margin-bottom: 10px;\\\">\\n            <span>\").concat(texts.delivery,\":</span>\\n            <span style=\\\"font-weight: bold;\\\">\").concat(invoiceData.deliveryPrice.toFixed(3),\" \").concat(texts.currency,\"</span>\\n          </div>\\n          <div style=\\\"\\n            display: flex;\\n            justify-content: space-between;\\n            padding-top: 10px;\\n            border-top: 2px solid #22c55e;\\n            font-size: 18px;\\n            font-weight: bold;\\n            color: #22c55e;\\n          \\\">\\n            <span>\").concat(texts.finalTotal,\":</span>\\n            <span>\").concat(invoiceData.total.toFixed(3),\" \").concat(texts.currency,\"</span>\\n          </div>\\n        </div>\\n\\n        <!-- Payment Method -->\\n        <div style=\\\"\\n          background: #f8fafc;\\n          padding: 15px;\\n          border-radius: 10px;\\n          margin-bottom: 30px;\\n        \\\">\\n          <p style=\\\"margin: 0; font-weight: bold;\\\">\\n            \").concat(texts.paymentMethod,\": \").concat(invoiceData.paymentMethod==='cash'?texts.cash:texts.link,\"\\n          </p>\\n        </div>\\n\\n        <!-- Footer -->\\n        <div style=\\\"\\n          text-align: center;\\n          padding: 20px;\\n          background: #22c55e;\\n          color: white;\\n          border-radius: 10px;\\n        \\\">\\n          <p style=\\\"margin: 0 0 10px 0; font-size: 16px; font-weight: bold;\\\">\").concat(texts.thankYou,\"</p>\\n          <p style=\\\"margin: 0; font-size: 14px; opacity: 0.9;\\\">\").concat(texts.contact,\"</p>\\n        </div>\\n      </div>\\n    \");}async generatePDF(invoiceData){// Validate and correct calculations\nconst validatedData=this.validateInvoiceData(invoiceData);const htmlContent=this.createInvoiceHTML(validatedData);// Create a temporary container\nconst container=document.createElement('div');container.innerHTML=htmlContent;container.style.position='absolute';container.style.left='-9999px';container.style.top='-9999px';// Add to body temporarily\ndocument.body.appendChild(container);try{// Generate canvas from HTML\nconst canvas=await html2canvas(container.firstElementChild,{scale:2,useCORS:true,allowTaint:true,backgroundColor:'#ffffff',width:800,height:1200});// Create PDF\nconst pdf=new jsPDF({orientation:'portrait',unit:'mm',format:'a4'});const imgData=canvas.toDataURL('image/png');const imgWidth=210;const pageHeight=295;const imgHeight=canvas.height*imgWidth/canvas.width;let heightLeft=imgHeight;let position=0;pdf.addImage(imgData,'PNG',0,position,imgWidth,imgHeight);heightLeft-=pageHeight;while(heightLeft>=0){position=heightLeft-imgHeight;pdf.addPage();pdf.addImage(imgData,'PNG',0,position,imgWidth,imgHeight);heightLeft-=pageHeight;}return pdf.output('blob');}finally{// Clean up\ndocument.body.removeChild(container);}}async downloadInvoice(invoiceData){try{// Validate calculations before generating PDF\nconst validatedData=this.validateInvoiceData(invoiceData);const pdfBlob=await this.generatePDF(validatedData);const url=URL.createObjectURL(pdfBlob);const link=document.createElement('a');link.href=url;link.download=\"invoice-\".concat(invoiceData.orderNumber,\".pdf\");document.body.appendChild(link);link.click();document.body.removeChild(link);URL.revokeObjectURL(url);}catch(error){console.error('Error downloading invoice:',error);throw error;}}async sendInvoiceEmail(invoiceData,customerEmail){try{// Validate calculations before generating PDF\nconst validatedData=this.validateInvoiceData(invoiceData);const pdfBlob=await this.generatePDF(validatedData);const base64PDF=await this.blobToBase64(pdfBlob);const templateParams={to_email:customerEmail,customer_name:invoiceData.customerInfo.name,order_number:invoiceData.orderNumber,total_amount:invoiceData.total.toFixed(3),attachment:base64PDF};await emailjs.send('your_service_id','your_template_id',templateParams,'your_public_key');}catch(error){console.error('Error sending invoice email:',error);throw error;}}blobToBase64(blob){return new Promise((resolve,reject)=>{const reader=new FileReader();reader.onload=()=>{const base64=reader.result.split(',')[1];resolve(base64);};reader.onerror=reject;reader.readAsDataURL(blob);});}}_InvoiceService=InvoiceService;InvoiceService.instance=void 0;export default InvoiceService;","map":{"version":3,"names":["jsPDF","html2canvas","emailjs","InvoiceService","getInstance","instance","getTexts","language","ar","title","subtitle","invoice","date","customer","name","phone","address","area","notes","items","product","quantity","price","total","subtotal","delivery","finalTotal","paymentMethod","cash","link","currency","thankYou","contact","en","calculateSubtotal","reduce","sum","item","selectedUnit","validateInvoiceData","invoiceData","calculatedSubtotal","calculatedTotal","deliveryPrice","_objectSpread","createInvoiceHTML","texts","isRTL","concat","orderNumber","customerInfo","map","itemTotal","productName","unitText","unit","toFixed","join","generatePDF","validatedData","htmlContent","container","document","createElement","innerHTML","style","position","left","top","body","appendChild","canvas","firstElementChild","scale","useCORS","allowTaint","backgroundColor","width","height","pdf","orientation","format","imgData","toDataURL","imgWidth","pageHeight","imgHeight","heightLeft","addImage","addPage","output","removeChild","downloadInvoice","pdfBlob","url","URL","createObjectURL","href","download","click","revokeObjectURL","error","console","sendInvoiceEmail","customerEmail","base64PDF","blobToBase64","templateParams","to_email","customer_name","order_number","total_amount","attachment","send","blob","Promise","resolve","reject","reader","FileReader","onload","base64","result","split","onerror","readAsDataURL","_InvoiceService"],"sources":["/Users/mac/Documents/GitHub/fruits/src/services/InvoiceService.ts"],"sourcesContent":["import jsPDF from 'jspdf';\nimport html2canvas from 'html2canvas';\nimport { CartItem, Language } from '../types';\nimport emailjs from '@emailjs/browser';\n\nexport interface InvoiceData {\n  orderNumber: string;\n  date: string;\n  customerInfo: {\n    name: string;\n    phone: string;\n    address: string;\n    area: string;\n    notes?: string;\n  };\n  items: CartItem[];\n  subtotal: number;\n  deliveryPrice: number;\n  total: number;\n  paymentMethod: 'link' | 'cash';\n  language: Language;\n}\n\nexport class InvoiceService {\n  private static instance: InvoiceService;\n\n  public static getInstance(): InvoiceService {\n    if (!InvoiceService.instance) {\n      InvoiceService.instance = new InvoiceService();\n    }\n    return InvoiceService.instance;\n  }\n\n  private getTexts(language: Language) {\n    return {\n      ar: {\n        title: 'فكهاني الكويت',\n        subtitle: 'فاتورة شراء',\n        invoice: 'فاتورة رقم',\n        date: 'التاريخ',\n        customer: 'بيانات العميل',\n        name: 'الاسم',\n        phone: 'الهاتف',\n        address: 'العنوان',\n        area: 'المحافظة',\n        notes: 'ملاحظات',\n        items: 'المنتجات',\n        product: 'المنتج',\n        quantity: 'الكمية',\n        price: 'السعر',\n        total: 'المجموع',\n        subtotal: 'المجموع الفرعي',\n        delivery: 'التوصيل',\n        finalTotal: 'المجموع النهائي',\n        paymentMethod: 'طريقة الدفع',\n        cash: 'دفع نقدي',\n        link: 'دفع إلكتروني',\n        currency: 'د.ك',\n        thankYou: 'شكراً لاختياركم فكهاني الكويت',\n        contact: 'للاستفسار: واتساب 99999999'\n      },\n      en: {\n        title: 'Fakahani Kuwait',\n        subtitle: 'Purchase Invoice',\n        invoice: 'Invoice No.',\n        date: 'Date',\n        customer: 'Customer Information',\n        name: 'Name',\n        phone: 'Phone',\n        address: 'Address',\n        area: 'Area',\n        notes: 'Notes',\n        items: 'Items',\n        product: 'Product',\n        quantity: 'Quantity',\n        price: 'Price',\n        total: 'Total',\n        subtotal: 'Subtotal',\n        delivery: 'Delivery',\n        finalTotal: 'Final Total',\n        paymentMethod: 'Payment Method',\n        cash: 'Cash Payment',\n        link: 'Electronic Payment',\n        currency: 'KWD',\n        thankYou: 'Thank you for choosing Fakahani Kuwait',\n        contact: 'For inquiries: WhatsApp 99999999'\n      }\n    };\n  }\n\n  // Helper method to calculate subtotal from items\n  private calculateSubtotal(items: CartItem[]): number {\n    return items.reduce((sum, item) => sum + (item.selectedUnit.price * item.quantity), 0);\n  }\n\n  // Helper method to validate invoice calculations\n  private validateInvoiceData(invoiceData: InvoiceData): InvoiceData {\n    const calculatedSubtotal = this.calculateSubtotal(invoiceData.items);\n    const calculatedTotal = calculatedSubtotal + invoiceData.deliveryPrice;\n    \n    return {\n      ...invoiceData,\n      subtotal: calculatedSubtotal,\n      total: calculatedTotal\n    };\n  }\n\n  private createInvoiceHTML(invoiceData: InvoiceData): string {\n    const texts = this.getTexts(invoiceData.language)[invoiceData.language];\n    const isRTL = invoiceData.language === 'ar';\n    \n    return `\n      <div style=\"\n        width: 800px;\n        font-family: 'Cairo', 'Arial', sans-serif;\n        direction: ${isRTL ? 'rtl' : 'ltr'};\n        background: white;\n        padding: 40px;\n        color: #333;\n      \">\n        <!-- Header -->\n        <div style=\"\n          background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);\n          color: white;\n          padding: 30px;\n          border-radius: 15px;\n          margin-bottom: 30px;\n          text-align: ${isRTL ? 'right' : 'left'};\n        \">\n          <h1 style=\"margin: 0; font-size: 28px; font-weight: bold;\">${texts.title}</h1>\n          <h2 style=\"margin: 5px 0 0 0; font-size: 16px; opacity: 0.9;\">${texts.subtitle}</h2>\n        </div>\n\n        <!-- Invoice Info -->\n        <div style=\"\n          display: flex;\n          justify-content: space-between;\n          margin-bottom: 30px;\n          padding: 20px;\n          background: #f8fafc;\n          border-radius: 10px;\n        \">\n          <div>\n            <p style=\"margin: 0 0 5px 0; font-weight: bold;\">${texts.invoice}: ${invoiceData.orderNumber}</p>\n            <p style=\"margin: 0; color: #666;\">${texts.date}: ${invoiceData.date}</p>\n          </div>\n        </div>\n\n        <!-- Customer Info -->\n        <div style=\"\n          margin-bottom: 30px;\n          padding: 20px;\n          background: #f8fafc;\n          border-radius: 10px;\n        \">\n          <h3 style=\"margin: 0 0 15px 0; color: #1f2937; font-weight: bold;\">${texts.customer}</h3>\n          <div style=\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;\">\n            <p style=\"margin: 0;\"><strong>${texts.name}:</strong> ${invoiceData.customerInfo.name}</p>\n            <p style=\"margin: 0;\"><strong>${texts.phone}:</strong> ${invoiceData.customerInfo.phone}</p>\n            <p style=\"margin: 0;\"><strong>${texts.address}:</strong> ${invoiceData.customerInfo.address}</p>\n            <p style=\"margin: 0;\"><strong>${texts.area}:</strong> ${invoiceData.customerInfo.area}</p>\n          </div>\n          ${invoiceData.customerInfo.notes ? `\n          <div style=\"margin-top: 15px; padding: 15px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;\">\n            <p style=\"margin: 0; font-weight: bold; color: #0f172a;\">${texts.notes}:</p>\n            <p style=\"margin: 5px 0 0 0; color: #374151;\">${invoiceData.customerInfo.notes}</p>\n          </div>\n          ` : ''}\n        </div>\n\n        <!-- Items Table -->\n        <div style=\"margin-bottom: 30px;\">\n          <h3 style=\"margin: 0 0 15px 0; color: #1f2937; font-weight: bold;\">${texts.items}</h3>\n          <table style=\"\n            width: 100%;\n            border-collapse: collapse;\n            background: white;\n            border-radius: 10px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          \">\n            <thead>\n              <tr style=\"background: #f3f4f6;\">\n                <th style=\"padding: 15px; text-align: ${isRTL ? 'right' : 'left'}; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.product}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.quantity}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.price}</th>\n                <th style=\"padding: 15px; text-align: center; font-weight: bold; border-bottom: 1px solid #e5e7eb;\">${texts.total}</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${invoiceData.items.map(item => {\n                const itemTotal = item.selectedUnit.price * item.quantity;\n                const productName = isRTL ? (item.product.name.ar || item.product.name.en) : item.product.name.en;\n                const unitText = isRTL ? item.selectedUnit.unit.ar : item.selectedUnit.unit.en;\n                return `\n                  <tr>\n                    <td style=\"padding: 12px; border-bottom: 1px solid #f3f4f6;\">${productName}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6;\">${item.quantity} ${unitText}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6;\">${item.selectedUnit.price.toFixed(3)}</td>\n                    <td style=\"padding: 12px; text-align: center; border-bottom: 1px solid #f3f4f6; font-weight: bold; color: #22c55e;\">${itemTotal.toFixed(3)}</td>\n                  </tr>\n                `;\n              }).join('')}\n            </tbody>\n          </table>\n        </div>\n\n        <!-- Totals -->\n        <div style=\"\n          background: #f8fafc;\n          padding: 20px;\n          border-radius: 10px;\n          margin-bottom: 30px;\n        \">\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n            <span>${texts.subtotal}:</span>\n            <span style=\"font-weight: bold;\">${invoiceData.subtotal.toFixed(3)} ${texts.currency}</span>\n          </div>\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n            <span>${texts.delivery}:</span>\n            <span style=\"font-weight: bold;\">${invoiceData.deliveryPrice.toFixed(3)} ${texts.currency}</span>\n          </div>\n          <div style=\"\n            display: flex;\n            justify-content: space-between;\n            padding-top: 10px;\n            border-top: 2px solid #22c55e;\n            font-size: 18px;\n            font-weight: bold;\n            color: #22c55e;\n          \">\n            <span>${texts.finalTotal}:</span>\n            <span>${invoiceData.total.toFixed(3)} ${texts.currency}</span>\n          </div>\n        </div>\n\n        <!-- Payment Method -->\n        <div style=\"\n          background: #f8fafc;\n          padding: 15px;\n          border-radius: 10px;\n          margin-bottom: 30px;\n        \">\n          <p style=\"margin: 0; font-weight: bold;\">\n            ${texts.paymentMethod}: ${invoiceData.paymentMethod === 'cash' ? texts.cash : texts.link}\n          </p>\n        </div>\n\n        <!-- Footer -->\n        <div style=\"\n          text-align: center;\n          padding: 20px;\n          background: #22c55e;\n          color: white;\n          border-radius: 10px;\n        \">\n          <p style=\"margin: 0 0 10px 0; font-size: 16px; font-weight: bold;\">${texts.thankYou}</p>\n          <p style=\"margin: 0; font-size: 14px; opacity: 0.9;\">${texts.contact}</p>\n        </div>\n      </div>\n    `;\n  }\n\n  public async generatePDF(invoiceData: InvoiceData): Promise<Blob> {\n    // Validate and correct calculations\n    const validatedData = this.validateInvoiceData(invoiceData);\n    const htmlContent = this.createInvoiceHTML(validatedData);\n    \n    // Create a temporary container\n    const container = document.createElement('div');\n    container.innerHTML = htmlContent;\n    container.style.position = 'absolute';\n    container.style.left = '-9999px';\n    container.style.top = '-9999px';\n    \n    // Add to body temporarily\n    document.body.appendChild(container);\n    \n    try {\n      // Generate canvas from HTML\n      const canvas = await html2canvas(container.firstElementChild as HTMLElement, {\n        scale: 2,\n        useCORS: true,\n        allowTaint: true,\n        backgroundColor: '#ffffff',\n        width: 800,\n        height: 1200\n      });\n      \n      // Create PDF\n      const pdf = new jsPDF({\n        orientation: 'portrait',\n        unit: 'mm',\n        format: 'a4'\n      });\n      \n      const imgData = canvas.toDataURL('image/png');\n      const imgWidth = 210;\n      const pageHeight = 295;\n      const imgHeight = (canvas.height * imgWidth) / canvas.width;\n      let heightLeft = imgHeight;\n      \n      let position = 0;\n      \n      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n      heightLeft -= pageHeight;\n      \n      while (heightLeft >= 0) {\n        position = heightLeft - imgHeight;\n        pdf.addPage();\n        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n        heightLeft -= pageHeight;\n      }\n      \n      return pdf.output('blob');\n    } finally {\n      // Clean up\n      document.body.removeChild(container);\n    }\n  }\n\n  public async downloadInvoice(invoiceData: InvoiceData): Promise<void> {\n    try {\n      // Validate calculations before generating PDF\n      const validatedData = this.validateInvoiceData(invoiceData);\n      const pdfBlob = await this.generatePDF(validatedData);\n      const url = URL.createObjectURL(pdfBlob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = `invoice-${invoiceData.orderNumber}.pdf`;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n    } catch (error) {\n      console.error('Error downloading invoice:', error);\n      throw error;\n    }\n  }\n\n  public async sendInvoiceEmail(invoiceData: InvoiceData, customerEmail: string): Promise<void> {\n    try {\n      // Validate calculations before generating PDF\n      const validatedData = this.validateInvoiceData(invoiceData);\n      const pdfBlob = await this.generatePDF(validatedData);\n      const base64PDF = await this.blobToBase64(pdfBlob);\n      \n      const templateParams = {\n        to_email: customerEmail,\n        customer_name: invoiceData.customerInfo.name,\n        order_number: invoiceData.orderNumber,\n        total_amount: invoiceData.total.toFixed(3),\n        attachment: base64PDF\n      };\n\n      await emailjs.send(\n        'your_service_id',\n        'your_template_id',\n        templateParams,\n        'your_public_key'\n      );\n    } catch (error) {\n      console.error('Error sending invoice email:', error);\n      throw error;\n    }\n  }\n\n  private blobToBase64(blob: Blob): Promise<string> {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => {\n        const base64 = (reader.result as string).split(',')[1];\n        resolve(base64);\n      };\n      reader.onerror = reject;\n      reader.readAsDataURL(blob);\n    });\n  }\n}\n\nexport default InvoiceService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}